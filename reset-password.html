<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#e85d04">
  <title>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • â€” CodeDuck</title>
  <meta name="robots" content="noindex, nofollow">
  <link rel="icon" href="images/og-thumbnail.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --orange:    #e85d04;
      --orange-dk: #c24e03;
      --orange-lt: #fff7f0;
      --bg:        #f4f5f7;
      --bg-card:   #ffffff;
      --border:    #e5e7eb;
      --text:      #1a1a2e;
      --text-sub:  #6b7280;
      --radius:    14px;
      --shadow:    0 2px 16px rgba(0,0,0,.08);
    }

    body {
      font-family: 'Noto Sans KR', 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* â”€â”€ í—¤ë” â”€â”€ */
    .auth-header {
      background: #fff;
      border-bottom: 1px solid var(--border);
      padding: 14px 24px;
    }
    .logo-link {
      display: inline-flex; align-items: center; gap: 8px;
      text-decoration: none;
    }
    .logo-text { font-size: 1.2rem; font-weight: 900; color: var(--text); letter-spacing: -0.5px; }
    .logo-text span { color: var(--orange); }

    /* â”€â”€ ë©”ì¸ â”€â”€ */
    .auth-main {
      flex: 1; display: flex;
      align-items: center; justify-content: center;
      padding: 40px 16px;
    }

    .auth-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      width: 100%; max-width: 420px;
      padding: 40px 36px;
    }

    /* â”€â”€ ë‹¨ê³„ í‘œì‹œ â”€â”€ */
    .steps {
      display: flex; gap: 0;
      margin-bottom: 32px;
    }
    .step {
      flex: 1; text-align: center;
      position: relative;
    }
    .step::after {
      content: '';
      position: absolute;
      top: 16px; left: 50%;
      width: 100%; height: 2px;
      background: var(--border);
      z-index: 0;
    }
    .step:last-child::after { display: none; }
    .step-circle {
      width: 32px; height: 32px;
      border-radius: 50%;
      background: var(--border);
      color: var(--text-sub);
      font-size: 0.85rem; font-weight: 700;
      display: inline-flex; align-items: center; justify-content: center;
      position: relative; z-index: 1;
      transition: all .3s;
    }
    .step.active .step-circle {
      background: var(--orange); color: #fff;
      box-shadow: 0 0 0 4px rgba(232,93,4,.2);
    }
    .step.done .step-circle {
      background: #10b981; color: #fff;
    }
    .step.done::after { background: #10b981; }
    .step-label {
      font-size: 0.72rem; color: var(--text-sub);
      margin-top: 6px; display: block;
    }
    .step.active .step-label { color: var(--orange); font-weight: 700; }
    .step.done .step-label   { color: #10b981; font-weight: 700; }

    /* â”€â”€ ê³µí†µ â”€â”€ */
    .card-title {
      font-size: 1.4rem; font-weight: 900;
      margin-bottom: 6px; letter-spacing: -0.5px;
    }
    .card-sub {
      font-size: 0.88rem; color: var(--text-sub);
      margin-bottom: 28px; line-height: 1.7;
    }

    .form-group { margin-bottom: 18px; }
    .form-label {
      display: block; font-size: 0.88rem;
      font-weight: 700; margin-bottom: 7px;
    }
    .form-input {
      width: 100%; padding: 12px 14px;
      border: 1.5px solid var(--border); border-radius: 10px;
      font-size: 0.95rem; font-family: inherit;
      color: var(--text); background: #fafafa;
      transition: border-color .18s, box-shadow .18s; outline: none;
    }
    .form-input:focus {
      border-color: var(--orange);
      box-shadow: 0 0 0 3px rgba(232,93,4,.12);
      background: #fff;
    }
    .form-input.error { border-color: #ef4444; }

    /* ë¹„ë°€ë²ˆí˜¸ ëˆˆ ì•„ì´ì½˜ */
    .pw-wrap { position: relative; }
    .pw-wrap .form-input { padding-right: 44px; }
    .pw-toggle {
      position: absolute; right: 12px; top: 50%;
      transform: translateY(-50%);
      background: none; border: none; cursor: pointer;
      color: var(--text-sub); font-size: 0.9rem; padding: 4px;
    }
    .pw-toggle:hover { color: var(--text); }

    /* ë¹„ë°€ë²ˆí˜¸ ê°•ë„ */
    .pw-strength { display: flex; gap: 4px; margin-top: 7px; }
    .pw-bar { flex: 1; height: 4px; border-radius: 4px; background: var(--border); transition: background .3s; }
    .pw-bar.weak   { background: #ef4444; }
    .pw-bar.medium { background: #f59e0b; }
    .pw-bar.strong { background: #10b981; }
    .pw-strength-text { font-size: 0.75rem; color: var(--text-sub); margin-top: 4px; }

    .form-error { font-size: 0.8rem; color: #ef4444; margin-top: 5px; display: none; }
    .form-error.show { display: block; }

    /* ì•Œë¦¼ ë°•ìŠ¤ */
    .alert {
      border-radius: 10px; padding: 12px 16px;
      font-size: 0.88rem; margin-bottom: 18px; display: none;
      line-height: 1.6;
    }
    .alert.show { display: block; }
    .alert.error   { background: #fef2f2; border: 1px solid #fca5a5; color: #dc2626; }
    .alert.success { background: #f0fdf4; border: 1px solid #86efac; color: #166534; }
    .alert.info    { background: #eff6ff; border: 1px solid #bfdbfe; color: #1e40af; }

    /* ë²„íŠ¼ */
    .btn-primary {
      width: 100%; padding: 14px;
      background: var(--orange); color: #fff;
      border: none; border-radius: 11px;
      font-size: 1rem; font-weight: 700; font-family: inherit;
      cursor: pointer; transition: background .18s, transform .12s;
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-primary:hover { background: var(--orange-dk); transform: translateY(-1px); }
    .btn-primary:disabled { background: #fdba74; cursor: not-allowed; transform: none; }

    .btn-outline {
      width: 100%; padding: 12px;
      background: transparent; color: var(--text-sub);
      border: 1.5px solid var(--border); border-radius: 11px;
      font-size: 0.9rem; font-weight: 600; font-family: inherit;
      cursor: pointer; margin-top: 10px;
      transition: all .18s;
      display: flex; align-items: center; justify-content: center; gap: 6px;
    }
    .btn-outline:hover { background: var(--bg); color: var(--text); }

    .spinner {
      width: 18px; height: 18px;
      border: 2.5px solid rgba(255,255,255,.4);
      border-top-color: #fff; border-radius: 50%;
      animation: spin .7s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ì„±ê³µ í™”ë©´ */
    .success-box { text-align: center; padding: 10px 0; }
    .success-icon { font-size: 3.5rem; margin-bottom: 16px; }
    .success-title { font-size: 1.3rem; font-weight: 900; margin-bottom: 10px; }
    .success-desc { font-size: 0.9rem; color: var(--text-sub); line-height: 1.7; margin-bottom: 24px; }
    .btn-go {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 12px 28px; background: var(--orange);
      color: #fff; border-radius: 10px; text-decoration: none;
      font-weight: 700; font-size: 0.95rem; transition: background .18s;
    }
    .btn-go:hover { background: var(--orange-dk); }

    /* í•˜ë‹¨ ë§í¬ */
    .footer-link {
      text-align: center; margin-top: 20px;
      font-size: 0.88rem; color: var(--text-sub);
    }
    .footer-link a { color: var(--orange); font-weight: 700; text-decoration: none; }
    .footer-link a:hover { text-decoration: underline; }

    /* ì´ë©”ì¼ ì°¾ê¸° ì•ˆë‚´ */
    .id-find-box {
      background: #fffbeb; border: 1px solid #fde68a;
      border-radius: 10px; padding: 14px 16px;
      font-size: 0.85rem; color: #92400e; line-height: 1.7;
      margin-top: 16px;
    }
    .id-find-box strong { color: #b45309; }
  </style>
</head>
<body>

  <!-- í—¤ë” -->
  <header class="auth-header">
    <a href="index.html" class="logo-link">
      <span style="font-size:1.5rem">ğŸ¦†</span>
      <span class="logo-text">Code<span>ducku</span></span>
    </a>
  </header>

  <!-- ë©”ì¸ -->
  <main class="auth-main">
    <div class="auth-card" id="mainCard">

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           STEP 1: ì´ë©”ì¼ ì…ë ¥ (ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="step1">
        <!-- ë‹¨ê³„ í‘œì‹œ -->
        <div class="steps">
          <div class="step active" id="s1">
            <div class="step-circle">1</div>
            <span class="step-label">ì´ë©”ì¼ ì…ë ¥</span>
          </div>
          <div class="step" id="s2">
            <div class="step-circle">2</div>
            <span class="step-label">ë©”ì¼ í™•ì¸</span>
          </div>
          <div class="step" id="s3">
            <div class="step-circle">3</div>
            <span class="step-label">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</span>
          </div>
        </div>

        <h1 class="card-title">ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</h1>
        <p class="card-sub">
          ê°€ì…í•  ë•Œ ì‚¬ìš©í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ë©´<br>
          ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.
        </p>

        <div class="alert" id="step1Alert"></div>

        <div class="form-group">
          <label class="form-label" for="findEmail">ê°€ì…í•œ ì´ë©”ì¼</label>
          <input type="email" id="findEmail" class="form-input"
                 placeholder="example@email.com" autocomplete="email">
          <div class="form-error" id="findEmailError">ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
        </div>

        <button class="btn-primary" id="sendBtn" onclick="sendResetEmail()">
          <i class="fas fa-paper-plane"></i>
          <span id="sendBtnText">ì¬ì„¤ì • ë§í¬ ë³´ë‚´ê¸°</span>
        </button>

        <button class="btn-outline" onclick="location.href='login.html'">
          <i class="fas fa-arrow-left"></i> ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        </button>

        <!-- ì•„ì´ë””(ì´ë©”ì¼) ì°¾ê¸° ì•ˆë‚´ -->
        <div class="id-find-box">
          <strong>ğŸ“§ ê°€ì…í•œ ì´ë©”ì¼ì´ ê¸°ì–µë‚˜ì§€ ì•Šìœ¼ì‹ ê°€ìš”?</strong><br>
          ì½”ë“œë•ì¿ ëŠ” ì´ë©”ì¼ë¡œë§Œ ê°€ì…í•  ìˆ˜ ìˆì–´ìš”.<br>
          í‰ì†Œ ìì£¼ ì“°ëŠ” ì´ë©”ì¼ ì£¼ì†Œë¡œ ë¡œê·¸ì¸ì„ ì‹œë„í•´ë³´ê±°ë‚˜,<br>
          <strong>"CodeDuck íšŒì›ê°€ì…"</strong> í‚¤ì›Œë“œë¡œ ë©”ì¼í•¨ì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”. ğŸ“¬
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           STEP 2: ë©”ì¼ ë°œì†¡ ì™„ë£Œ
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="step2" style="display:none">
        <div class="steps">
          <div class="step done" id="s1b">
            <div class="step-circle"><i class="fas fa-check"></i></div>
            <span class="step-label">ì´ë©”ì¼ ì…ë ¥</span>
          </div>
          <div class="step active" id="s2b">
            <div class="step-circle">2</div>
            <span class="step-label">ë©”ì¼ í™•ì¸</span>
          </div>
          <div class="step" id="s3b">
            <div class="step-circle">3</div>
            <span class="step-label">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</span>
          </div>
        </div>

        <div style="text-align:center; padding: 10px 0 24px">
          <div style="font-size:3rem; margin-bottom:16px">âœ‰ï¸</div>
          <h2 class="card-title">ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”!</h2>
          <p class="card-sub">
            <strong id="sentEmail" style="color:var(--orange)"></strong><br>
            ìœ¼ë¡œ ì¬ì„¤ì • ë§í¬ë¥¼ ë°œì†¡í–ˆìŠµë‹ˆë‹¤.<br><br>
            ë©”ì¼ì˜ <strong>ë§í¬ë¥¼ í´ë¦­</strong>í•˜ë©´<br>
            ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆì–´ìš”.
          </p>
        </div>

        <div class="alert info show">
          <i class="fas fa-info-circle"></i>
          ë©”ì¼ì´ ì•ˆ ë³´ì´ë©´ <strong>ìŠ¤íŒ¸í•¨</strong>ì„ í™•ì¸í•´ë³´ì„¸ìš”.<br>
          ë§í¬ëŠ” <strong>1ì‹œê°„</strong> ë™ì•ˆ ìœ íš¨í•©ë‹ˆë‹¤.
        </div>

        <button class="btn-outline" onclick="resendEmail()" id="resendBtn">
          <i class="fas fa-redo"></i> ë©”ì¼ ë‹¤ì‹œ ë³´ë‚´ê¸°
        </button>
        <button class="btn-outline" onclick="location.href='login.html'" style="margin-top:8px">
          <i class="fas fa-sign-in-alt"></i> ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        </button>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           STEP 3: ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
           (ì´ë©”ì¼ ë§í¬ í´ë¦­ í›„ ì´ í™”ë©´)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="step3" style="display:none">
        <div class="steps">
          <div class="step done">
            <div class="step-circle"><i class="fas fa-check"></i></div>
            <span class="step-label">ì´ë©”ì¼ ì…ë ¥</span>
          </div>
          <div class="step done">
            <div class="step-circle"><i class="fas fa-check"></i></div>
            <span class="step-label">ë©”ì¼ í™•ì¸</span>
          </div>
          <div class="step active">
            <div class="step-circle">3</div>
            <span class="step-label">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</span>
          </div>
        </div>

        <h1 class="card-title">ğŸ” ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •</h1>
        <p class="card-sub">ìƒˆë¡œ ì‚¬ìš©í•  ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>

        <div class="alert" id="step3Alert"></div>

        <div class="form-group">
          <label class="form-label" for="newPw">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
          <div class="pw-wrap">
            <input type="password" id="newPw" class="form-input"
                   placeholder="8ì ì´ìƒ, ì˜ë¬¸+ìˆ«ì í¬í•¨" autocomplete="new-password">
            <button type="button" class="pw-toggle" onclick="togglePw('newPw', 'eye1')">
              <i class="fas fa-eye" id="eye1"></i>
            </button>
          </div>
          <div class="pw-strength" id="pwStrength">
            <div class="pw-bar" id="bar1"></div>
            <div class="pw-bar" id="bar2"></div>
            <div class="pw-bar" id="bar3"></div>
          </div>
          <div class="pw-strength-text" id="pwStrengthText"></div>
          <div class="form-error" id="newPwError">8ì ì´ìƒ, ì˜ë¬¸+ìˆ«ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="confirmPw">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <div class="pw-wrap">
            <input type="password" id="confirmPw" class="form-input"
                   placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ í•œ ë²ˆ ë” ì…ë ¥í•´ì£¼ì„¸ìš”" autocomplete="new-password">
            <button type="button" class="pw-toggle" onclick="togglePw('confirmPw', 'eye2')">
              <i class="fas fa-eye" id="eye2"></i>
            </button>
          </div>
          <div class="form-error" id="confirmPwError">ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
        </div>

        <button class="btn-primary" id="changePwBtn" onclick="changePassword()">
          <i class="fas fa-lock"></i>
          <span id="changePwText">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½í•˜ê¸°</span>
        </button>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           STEP 4: ë³€ê²½ ì™„ë£Œ
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="step4" style="display:none">
        <div class="success-box">
          <div class="success-icon">ğŸ‰</div>
          <div class="success-title">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì™„ë£Œ!</div>
          <p class="success-desc">
            ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½ì´ ì™„ë£Œëì–´ìš”.<br>
            ì§€ê¸ˆ ë°”ë¡œ ë¡œê·¸ì¸í•´ë³´ì„¸ìš”!
          </p>
          <a href="login.html" class="btn-go">
            <i class="fas fa-sign-in-alt"></i> ë¡œê·¸ì¸í•˜ê¸°
          </a>
        </div>
      </div>

    </div>
  </main>

  <!-- Supabase JS v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script src="js/auth.js"></script>
  <script>
    let emailForReset = '';

    // â”€â”€ í˜ì´ì§€ ë¡œë“œ ì‹œ: URL í•´ì‹œì— access_tokenì´ ìˆìœ¼ë©´ STEP 3 í‘œì‹œ â”€â”€
    async function initPage() {
      const hash = window.location.hash;

      // Supabase ì´ë©”ì¼ ë§í¬ í´ë¦­ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬
      // URL í˜•ì‹: /reset-password.html#access_token=...&type=recovery
      if (hash.includes('type=recovery') || hash.includes('access_token')) {
        // Supabase í´ë¼ì´ì–¸íŠ¸ê°€ í•´ì‹œë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•¨
        // ì„¸ì…˜ì´ ì„¤ì •ë  ë•Œê¹Œì§€ ì ê¹ ëŒ€ê¸°
        await new Promise(r => setTimeout(r, 800));
        const session = await getSession();
        if (session) {
          showStep(3);
          return;
        }
      }

      // ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœì—ì„œ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ìš”ì²­
      const params = new URLSearchParams(location.search);
      if (params.get('mode') === 'change') {
        const session = await getSession();
        if (session) { showStep(3); return; }
      }

      showStep(1);
    }

    // â”€â”€ ì¬ì„¤ì • ë©”ì¼ ë°œì†¡ â”€â”€
    async function sendResetEmail() {
      const email = document.getElementById('findEmail').value.trim();
      const errEl = document.getElementById('findEmailError');
      const alertEl = document.getElementById('step1Alert');

      errEl.classList.remove('show');
      alertEl.className = 'alert';
      document.getElementById('findEmail').classList.remove('error');

      const emailReg = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailReg.test(email)) {
        errEl.classList.add('show');
        document.getElementById('findEmail').classList.add('error');
        return;
      }

      const btn = document.getElementById('sendBtn');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div> ë°œì†¡ ì¤‘...';

      try {
        const sb = getClient();
        const { error } = await sb.auth.resetPasswordForEmail(email, {
          redirectTo: `${location.origin}/reset-password.html`
        });

        if (error) {
          // SupabaseëŠ” ë³´ì•ˆìƒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë©”ì¼ë„ ì„±ê³µ ì‘ë‹µì„ ì¤Œ
          // ì‹¤ì œ ì—ëŸ¬ë§Œ ì²˜ë¦¬
          alertEl.textContent = 'âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
          alertEl.className = 'alert error show';
          btn.disabled = false;
          btn.innerHTML = '<i class="fas fa-paper-plane"></i> <span>ì¬ì„¤ì • ë§í¬ ë³´ë‚´ê¸°</span>';
        } else {
          emailForReset = email;
          document.getElementById('sentEmail').textContent = email;
          showStep(2);
        }
      } catch (err) {
        alertEl.textContent = 'âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
        alertEl.className = 'alert error show';
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-paper-plane"></i> <span>ì¬ì„¤ì • ë§í¬ ë³´ë‚´ê¸°</span>';
      }
    }

    // â”€â”€ ì¬ë°œì†¡ â”€â”€
    async function resendEmail() {
      if (!emailForReset) { showStep(1); return; }
      const btn = document.getElementById('resendBtn');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner" style="border-color:rgba(0,0,0,.2);border-top-color:#666"></div> ë°œì†¡ ì¤‘...';

      const sb = getClient();
      await sb.auth.resetPasswordForEmail(emailForReset, {
        redirectTo: `${location.origin}/reset-password.html`
      });

      setTimeout(() => {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-check" style="color:#10b981"></i> ì¬ë°œì†¡ ì™„ë£Œ!';
        setTimeout(() => {
          btn.innerHTML = '<i class="fas fa-redo"></i> ë©”ì¼ ë‹¤ì‹œ ë³´ë‚´ê¸°';
        }, 3000);
      }, 1000);
    }

    // â”€â”€ ìƒˆ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ â”€â”€
    async function changePassword() {
      const pw  = document.getElementById('newPw').value;
      const cpw = document.getElementById('confirmPw').value;
      const alertEl = document.getElementById('step3Alert');

      document.querySelectorAll('#step3 .form-error').forEach(el => el.classList.remove('show'));
      alertEl.className = 'alert';

      let valid = true;
      if (pw.length < 8 || !/[a-zA-Z]/.test(pw) || !/\d/.test(pw)) {
        document.getElementById('newPwError').classList.add('show'); valid = false;
      }
      if (pw !== cpw) {
        document.getElementById('confirmPwError').classList.add('show'); valid = false;
      }
      if (!valid) return;

      const btn = document.getElementById('changePwBtn');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div> ë³€ê²½ ì¤‘...';

      try {
        const sb = getClient();
        const { error } = await sb.auth.updateUser({ password: pw });

        if (error) {
          let msg = error.message || 'ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
          if (msg.includes('same password')) msg = 'í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ì™€ ë™ì¼í•©ë‹ˆë‹¤. ë‹¤ë¥¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
          alertEl.textContent = 'âŒ ' + msg;
          alertEl.className = 'alert error show';
          btn.disabled = false;
          btn.innerHTML = '<i class="fas fa-lock"></i> <span>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½í•˜ê¸°</span>';
        } else {
          showStep(4);
        }
      } catch (err) {
        alertEl.textContent = 'âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
        alertEl.className = 'alert error show';
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-lock"></i> <span>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½í•˜ê¸°</span>';
      }
    }

    // â”€â”€ ë¹„ë°€ë²ˆí˜¸ ëˆˆ ì•„ì´ì½˜ í† ê¸€ â”€â”€
    function togglePw(inputId, iconId) {
      const input = document.getElementById(inputId);
      const icon  = document.getElementById(iconId);
      const show  = input.type === 'password';
      input.type  = show ? 'text' : 'password';
      icon.className = show ? 'fas fa-eye-slash' : 'fas fa-eye';
    }

    // â”€â”€ ë¹„ë°€ë²ˆí˜¸ ê°•ë„ â”€â”€
    document.addEventListener('DOMContentLoaded', () => {
      const pw = document.getElementById('newPw');
      if (!pw) return;
      pw.addEventListener('input', () => {
        const val = pw.value;
        const b1 = document.getElementById('bar1');
        const b2 = document.getElementById('bar2');
        const b3 = document.getElementById('bar3');
        const txt = document.getElementById('pwStrengthText');
        b1.className = b2.className = b3.className = 'pw-bar';
        if (!val) { txt.textContent = ''; return; }
        let score = 0;
        if (val.length >= 8) score++;
        if (/[a-zA-Z]/.test(val) && /\d/.test(val)) score++;
        if (/[^a-zA-Z0-9]/.test(val)) score++;
        if (score === 1) { b1.classList.add('weak'); txt.textContent = 'âš ï¸ ì·¨ì•½'; txt.style.color = '#ef4444'; }
        else if (score === 2) { b1.classList.add('medium'); b2.classList.add('medium'); txt.textContent = 'ğŸ”¶ ë³´í†µ'; txt.style.color = '#f59e0b'; }
        else if (score === 3) { b1.classList.add('strong'); b2.classList.add('strong'); b3.classList.add('strong'); txt.textContent = 'âœ… ê°•í•¨'; txt.style.color = '#10b981'; }
      });
    });

    // â”€â”€ ë‹¨ê³„ ì „í™˜ â”€â”€
    function showStep(n) {
      [1, 2, 3, 4].forEach(i => {
        document.getElementById('step' + i).style.display = (i === n) ? 'block' : 'none';
      });
    }

    // ì—”í„°í‚¤ ì²˜ë¦¬
    document.addEventListener('keydown', (e) => {
      if (e.key !== 'Enter') return;
      const s1 = document.getElementById('step1');
      const s3 = document.getElementById('step3');
      if (s1 && s1.style.display !== 'none') sendResetEmail();
      if (s3 && s3.style.display !== 'none') changePassword();
    });

    // ì´ˆê¸°í™”
    initPage();
  </script>
</body>
</html>
