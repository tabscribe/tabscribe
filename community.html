<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#e85d04">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="icon" href="images/og-thumbnail.png" type="image/png">
    <link rel="apple-touch-icon" href="images/og-thumbnail.png">
    <title>ì½”ë“œë•ì¿  ì»¤ë®¤ë‹ˆí‹°</title>
    <meta name="description" content="ê¸°íƒ€ë¦¬ìŠ¤íŠ¸Â·ë² ì´ì‹œìŠ¤íŠ¸Â·ë°´ë“œë§¨ì„ ìœ„í•œ ì»¤ë®¤ë‹ˆí‹°. ë°´ë“œ êµ¬ì¸êµ¬ì§, ê°œì¸ë ˆìŠ¨, ì¤‘ê³ ì•…ê¸° ê±°ë˜, ììœ ê²Œì‹œíŒ.">
    <!-- ê²€ìƒ‰ì—”ì§„ ìµœì í™” (SEO) -->
    <meta name="robots" content="index, follow">
    <meta name="author" content="COODUCK">
    <meta name="keywords" content="ê¸°íƒ€ ì»¤ë®¤ë‹ˆí‹°, ë°´ë“œ êµ¬ì¸, ê¸°íƒ€ ë ˆìŠ¨, ì¤‘ê³ ì•…ê¸°, ë² ì´ìŠ¤, ë°´ë“œë§¨, ì½”ë“œë•ì¿ , Codeducku">
    <link rel="canonical" href="https://codeducku.vercel.app/community.html">
    <meta property="og:type" content="website">
    <meta property="og:title" content="ì½”ë“œë•ì¿  ì»¤ë®¤ë‹ˆí‹°">
    <meta property="og:description" content="ê¸°íƒ€ë¦¬ìŠ¤íŠ¸Â·ë² ì´ì‹œìŠ¤íŠ¸Â·ë°´ë“œë§¨ì„ ìœ„í•œ ì»¤ë®¤ë‹ˆí‹°. ë°´ë“œ êµ¬ì¸êµ¬ì§, ê°œì¸ë ˆìŠ¨, ì¤‘ê³ ì•…ê¸° ê±°ë˜.">
    <meta property="og:image" content="https://www.genspark.ai/api/files/s/EsaPAYLv">
    <meta property="og:locale" content="ko_KR">
    <meta property="og:site_name" content="ì½”ë“œë•ì¿  by COODUCK">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ì½”ë“œë•ì¿  ì»¤ë®¤ë‹ˆí‹°">
    <meta name="twitter:description" content="ê¸°íƒ€ë¦¬ìŠ¤íŠ¸Â·ë² ì´ì‹œìŠ¤íŠ¸Â·ë°´ë“œë§¨ì„ ìœ„í•œ ì»¤ë®¤ë‹ˆí‹°.">
    <meta name="twitter:image" content="https://www.genspark.ai/api/files/s/EsaPAYLv">
    <!-- Google Search Console ì†Œìœ ê¶Œ ì¸ì¦ -->
    <meta name="google-site-verification" content="y_LIOep_Kgw8SPVqt4XB5oCKlfscobw2V2fkQV2J6HM" />
    <!-- Naver Search Advisor ì†Œìœ ê¶Œ ì¸ì¦ -->
    <meta name="naver-site-verification" content="72f154aec62c295b28b8f27b077b8c961e862892" />
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="js/ads.js"></script>
    <style>
        /* â”€â”€ ì»¤ë®¤ë‹ˆí‹° ì „ìš© ìŠ¤íƒ€ì¼ â”€â”€ */
        .comm-hero {
            background: linear-gradient(135deg, #fff7f0 0%, #fef3c7 50%, #ecfdf5 100%);
            border-bottom: 1px solid var(--border-light);
            padding: 36px 0 28px;
        }
        .comm-hero-inner {
            max-width: 1360px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            gap: 18px;
        }
        .comm-hero-icon {
            width: 60px; height: 60px;
            background: linear-gradient(135deg, #e85d04, #f48c06);
            border-radius: 18px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem;
            box-shadow: 0 4px 16px rgba(232,93,4,0.25);
            flex-shrink: 0;
        }
        .comm-hero h1 {
            font-size: 1.7rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        .comm-hero p {
            font-size: 0.88rem;
            color: var(--text-secondary);
        }
        .comm-stats {
            margin-left: auto;
            display: flex;
            gap: 20px;
            flex-shrink: 0;
        }
        .comm-stat-item {
            text-align: center;
        }
        .comm-stat-item .num {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--accent);
        }
        .comm-stat-item .lbl {
            font-size: 0.72rem;
            color: var(--text-muted);
        }

        /* â”€â”€ ë©”ì¸ ë ˆì´ì•„ì›ƒ â”€â”€ */
        .comm-layout {
            max-width: 100%;
            margin: 0 auto;
            padding: 28px 20px 60px;
            display: grid;
            grid-template-columns: 230px 1fr;
            gap: 24px;
        }
        @media (max-width: 768px) {
            .comm-layout { grid-template-columns: 1fr; }
            .comm-sidebar { display: none; }
            .comm-main-layout {
                padding: 12px 10px 60px;
                gap: 0;
            }
            .comm-hero-inner {
                flex-wrap: wrap;
                gap: 12px;
                padding: 0 14px;
            }
            .comm-hero h1 { font-size: clamp(1.1rem, 5vw, 1.4rem); word-break: keep-all; }
            .comm-hero p  { font-size: 0.82rem; word-break: keep-all; }
            .comm-stats { margin-left: 0; gap: 12px; flex-wrap: wrap; }
            .comm-stat-item { font-size: 0.8rem; }
            /* í•„í„°/ê²€ìƒ‰ë°” ëª¨ë°”ì¼ */
            .search-bar { flex-wrap: wrap; gap: 8px; padding: 10px 12px; }
            .search-bar input { width: 100%; min-width: 0; font-size: 0.9rem; }
            .search-bar select { flex: 1 1 calc(50% - 4px); min-width: 0; font-size: 0.82rem; }
            .search-bar button { width: 100%; padding: 9px; }
            /* íƒ­ ë°” */
            .tab-bar { flex-wrap: wrap; gap: 6px; padding: 10px 12px; }
            .tab-btn  { font-size: 0.78rem; padding: 6px 12px; }
            /* ê²Œì‹œê¸€ ì¹´ë“œ */
            .post-card { padding: 12px 14px; }
            .post-title { font-size: 0.9rem; white-space: normal; word-break: keep-all; }
            .post-preview { font-size: 0.78rem; }
            .post-card-top { gap: 8px; }
            /* ê¸€ì“°ê¸° ë²„íŠ¼ */
            .write-btn { font-size: 0.82rem; padding: 8px 14px; }
            /* í—¤ë” ëª¨ë°”ì¼ */
            .comm-hero { padding: 22px 0 18px; }
        }

        /* â”€â”€ ì‚¬ì´ë“œë°” â”€â”€ */
        .comm-sidebar {
            position: sticky;
            top: 20px;
            align-self: start;
        }
        .sidebar-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 12px 10px;
            margin-bottom: 10px;
            box-shadow: var(--shadow);
        }
        .sidebar-section h3 {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
            padding: 0 6px;
        }
        .sidebar-menu {
            list-style: none;
        }
        .sidebar-menu li a, .sidebar-menu li button {
            display: flex;
            align-items: center;
            gap: 7px;
            padding: 6px 8px;
            border-radius: 6px;
            font-size: 0.83rem;
            font-weight: 500;
            color: var(--text-secondary);
            text-decoration: none;
            cursor: pointer;
            background: none;
            border: none;
            width: 100%;
            text-align: left;
            transition: all 0.15s;
        }
        .sidebar-menu li a:hover, .sidebar-menu li button:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        .sidebar-menu li a.active, .sidebar-menu li button.active {
            background: #fff7f0;
            color: var(--accent);
            font-weight: 700;
        }
        .sidebar-menu li a .badge, .sidebar-menu li button .badge {
            margin-left: auto;
            background: #fee2e2;
            color: #dc2626;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 1px 7px;
            border-radius: 99px;
        }
        .sidebar-menu li a .badge.blue { background: #dbeafe; color: #2563eb; }
        .sidebar-menu li a .badge.green { background: #dcfce7; color: #16a34a; }
        .sidebar-menu li a .badge.orange { background: #fff7ed; color: #ea580c; }
        .sidebar-menu li button .badge.blue { background: #dbeafe; color: #2563eb; }
        .sidebar-menu li button .badge.green { background: #dcfce7; color: #16a34a; }
        .sidebar-menu li button .badge.orange { background: #fff7ed; color: #ea580c; }

        /* ì¤‘ê³ ì¥í„° ì„œë¸Œë©”ë‰´ */
        .used-sub-menu {
            list-style: none;
            padding-left: 8px;
            margin-top: 2px;
            display: none;
        }
        .used-sub-menu.open { display: block; }
        .used-sub-menu li button {
            font-size: 0.82rem !important;
            padding: 5px 10px !important;
            color: var(--text-muted) !important;
        }
        .used-sub-menu li button:hover, .used-sub-menu li button.active {
            color: var(--accent) !important;
            background: #fff7f0 !important;
        }

        /* â”€â”€ ì½˜í…ì¸  ì˜ì—­ â”€â”€ */
        .comm-content { min-width: 0; }

        /* íƒ­ + í•„í„° ë°” */
        .tab-filter-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
            flex-wrap: wrap;
        }
        .category-title {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .category-title .icon-badge {
            width: 32px; height: 32px;
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1rem;
        }
        .filter-group {
            margin-left: auto;
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .filter-select {
            padding: 7px 14px;
            border: 1.5px solid var(--border);
            border-radius: 8px;
            font-size: 0.84rem;
            color: var(--text-secondary);
            background: var(--bg-card);
            cursor: pointer;
            outline: none;
        }
        .filter-select:focus { border-color: var(--accent); }
        .write-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 20px;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }
        .write-btn:hover { background: #c24e03; transform: translateY(-1px); }

        /* ê²€ìƒ‰ ë°” */
        .search-bar {
            display: flex;
            gap: 8px;
            margin-bottom: 14px;
        }
        .search-bar input {
            flex: 1;
            padding: 10px 16px;
            border: 1.5px solid var(--border);
            border-radius: 10px;
            font-size: 0.92rem;
            outline: none;
            color: var(--text-primary);
            background: var(--bg-card);
        }
        .search-bar input:focus { border-color: var(--accent); }
        .search-bar button {
            padding: 10px 18px;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 0.88rem;
            font-weight: 600;
            cursor: pointer;
        }

        /* ê²Œì‹œê¸€ ëª©ë¡ */
        .post-list { display: flex; flex-direction: column; gap: 8px; }

        .post-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 18px 22px;
            cursor: pointer;
            transition: all 0.18s;
            box-shadow: var(--shadow);
        }
        .post-card:hover {
            border-color: #fdba74;
            background: #fffaf7;
            box-shadow: 0 4px 24px rgba(232,93,4,0.12);
            transform: translateY(-1px);
        }
        .post-card-top {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        .post-category-badge {
            flex-shrink: 0;
            padding: 3px 9px;
            border-radius: 6px;
            font-size: 0.72rem;
            font-weight: 700;
            margin-top: 2px;
        }
        .badge-band { background: #fee2e2; color: #dc2626; }
        .badge-lesson { background: #dbeafe; color: #2563eb; }
        .badge-used { background: #dcfce7; color: #16a34a; }
        .badge-talk { background: #fef9c3; color: #ca8a04; }
        .badge-info { background: #f3e8ff; color: #9333ea; }

        .post-title-area { flex: 1; min-width: 0; }
        .post-title {
            font-size: 1.03rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.4;
        }
        .post-preview {
            font-size: 0.85rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.5;
        }
        .post-price {
            flex-shrink: 0;
            font-size: 1.05rem;
            font-weight: 800;
            color: #16a34a;
            margin-left: auto;
            padding-left: 12px;
        }
        .post-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 10px;
            font-size: 0.82rem;
            color: var(--text-muted);
            border-top: 1px solid var(--border);
            padding-top: 8px;
        }
        .post-meta span { display: flex; align-items: center; gap: 4px; }
        .post-meta .meta-views { color: #2563eb; font-weight: 600; }
        .post-meta .meta-date { margin-left: auto; color: var(--text-muted); }
        .post-tags {
            margin-top: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        .tag {
            padding: 2px 8px;
            background: var(--bg-secondary);
            border-radius: 6px;
            font-size: 0.72rem;
            color: var(--text-secondary);
        }

        /* ì¤‘ê³ ì¥í„° ì¹´ë“œ ê·¸ë¦¬ë“œ */
        .gear-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }
        .gear-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.18s;
            box-shadow: var(--shadow);
        }
        .gear-card:hover {
            border-color: #86efac;
            box-shadow: 0 6px 24px rgba(22,163,74,0.12);
            transform: translateY(-2px);
        }
        .gear-card-img {
            height: 140px;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            position: relative;
        }
        .gear-card-img .subcategory-icon {
            font-size: 3.5rem;
            opacity: 0.6;
        }
        .gear-status-badge {
            position: absolute;
            top: 10px; right: 10px;
            padding: 3px 9px;
            border-radius: 6px;
            font-size: 0.72rem;
            font-weight: 700;
        }
        .status-active { background: #dcfce7; color: #16a34a; }
        .status-sold { background: #f1f5f9; color: #94a3b8; }
        .gear-card-body { padding: 12px 14px; }
        .gear-card-title {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .gear-card-author {
            font-size: 0.78rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        .gear-card-price {
            font-size: 1.1rem;
            font-weight: 800;
            color: #16a34a;
        }
        .gear-card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* ë ˆìŠ¨ ì¹´ë“œ */
        .lesson-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 14px;
        }
        .lesson-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 18px;
            cursor: pointer;
            transition: all 0.18s;
            box-shadow: var(--shadow);
        }
        .lesson-card:hover {
            border-color: #93c5fd;
            box-shadow: 0 6px 24px rgba(37,99,235,0.10);
            transform: translateY(-2px);
        }
        .lesson-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        .lesson-avatar {
            width: 46px; height: 46px;
            border-radius: 12px;
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        .lesson-card-title {
            font-size: 0.93rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 3px;
        }
        .lesson-card-author {
            font-size: 0.78rem;
            color: var(--text-muted);
        }
        .lesson-card-desc {
            font-size: 0.82rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .lesson-price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .lesson-price {
            font-size: 1.05rem;
            font-weight: 800;
            color: #2563eb;
        }
        .lesson-badge {
            padding: 3px 8px;
            background: #eff6ff;
            color: #2563eb;
            border-radius: 6px;
            font-size: 0.72rem;
            font-weight: 600;
        }

        /* êµ¬ì¸êµ¬ì§ ì¹´ë“œ */
        .recruit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 14px;
        }
        .recruit-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 18px;
            cursor: pointer;
            transition: all 0.18s;
            box-shadow: var(--shadow);
        }
        .recruit-card:hover {
            border-color: #fca5a5;
            box-shadow: 0 6px 24px rgba(220,38,38,0.08);
            transform: translateY(-2px);
        }
        .recruit-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .recruit-icon {
            width: 42px; height: 42px;
            border-radius: 10px;
            background: linear-gradient(135deg, #fff1f2, #ffe4e6);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem;
            flex-shrink: 0;
        }
        .recruit-title {
            font-size: 0.93rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        .recruit-author { font-size: 0.76rem; color: var(--text-muted); }
        .recruit-body {
            font-size: 0.83rem;
            color: var(--text-secondary);
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .recruit-footer {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .recruit-tag {
            padding: 3px 8px;
            background: #fff1f2;
            color: #dc2626;
            border-radius: 6px;
            font-size: 0.72rem;
            font-weight: 600;
        }
        .recruit-location {
            padding: 3px 8px;
            background: var(--bg-secondary);
            color: var(--text-muted);
            border-radius: 6px;
            font-size: 0.72rem;
        }

        /* ë¹ˆ ëª©ë¡ ì•ˆë‚´ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }
        .empty-state .empty-icon { font-size: 3rem; margin-bottom: 12px; opacity: 0.4; }
        .empty-state p { font-size: 0.9rem; }

        /* í˜ì´ì§€ë„¤ì´ì…˜ */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-top: 24px;
        }
        .page-btn {
            width: 34px; height: 34px;
            border: 1.5px solid var(--border);
            border-radius: 8px;
            background: var(--bg-card);
            font-size: 0.85rem;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.15s;
        }
        .page-btn:hover { border-color: var(--accent); color: var(--accent); }
        .page-btn.active { background: var(--accent); border-color: var(--accent); color: #fff; font-weight: 700; }

        /* ê¸€ì“°ê¸° ëª¨ë‹¬ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }
        .modal-overlay.open {
            opacity: 1;
            pointer-events: all;
        }
        .modal {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 32px 36px;
            width: 100%;
            max-width: 860px;
            max-height: 88vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.22);
            transform: translateY(10px);
            transition: transform 0.2s;
        }
        .modal-overlay.open .modal { transform: translateY(0); }
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .modal-header h2 { font-size: 1.1rem; font-weight: 800; color: var(--text-primary); }
        .modal-close {
            width: 32px; height: 32px;
            border: none;
            background: var(--bg-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            color: var(--text-muted);
            display: flex; align-items: center; justify-content: center;
        }
        .modal-close:hover { background: #fee2e2; color: #dc2626; }
        .form-group { margin-bottom: 14px; }
        .form-group label {
            display: block;
            font-size: 0.83rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 9px 12px;
            border: 1.5px solid var(--border);
            border-radius: 8px;
            font-size: 0.88rem;
            color: var(--text-primary);
            background: var(--bg-card);
            outline: none;
            transition: border-color 0.15s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: var(--accent);
        }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        .btn-cancel {
            padding: 9px 18px;
            border: 1.5px solid var(--border);
            border-radius: 8px;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.88rem;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-submit {
            padding: 9px 22px;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 0.88rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.15s;
        }
        .btn-submit:hover { background: #c24e03; }

        /* ê²Œì‹œê¸€ ìƒì„¸ ëª¨ë‹¬ */
        .detail-modal {
            max-width: 920px;
            padding: 36px 40px;
        }
        .detail-title {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 10px;
            line-height: 1.4;
        }
        .detail-meta {
            display: flex;
            gap: 14px;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-light);
        }
        .detail-meta span { display: flex; align-items: center; gap: 4px; }
        .detail-body {
            font-size: 0.97rem;
            color: var(--text-secondary);
            line-height: 1.85;
            margin-bottom: 20px;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .detail-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 16px; }
        .detail-contact {
            padding: 12px 16px;
            background: #fff7f0;
            border: 1px solid #fed7aa;
            border-radius: 10px;
            font-size: 0.88rem;
            color: #ea580c;
        }
        .detail-contact strong { display: block; margin-bottom: 4px; }
        .detail-price-box {
            padding: 12px 16px;
            background: #f0fdf4;
            border: 1px solid #86efac;
            border-radius: 10px;
            margin-bottom: 14px;
        }
        .detail-price-box .price-lbl { font-size: 0.8rem; color: #16a34a; font-weight: 600; margin-bottom: 4px; }
        .detail-price-box .price-val { font-size: 1.3rem; font-weight: 800; color: #15803d; }

        /* ëª¨ë‹¬ ëª¨ë°”ì¼ ëŒ€ì‘ */
        @media (max-width: 768px) {
            .modal {
                padding: 22px 18px;
                max-height: 92vh;
                border-radius: 16px;
            }
            .detail-modal {
                padding: 22px 18px;
            }
            .detail-title { font-size: 1.1rem; }
            .detail-body  { font-size: 0.9rem; }
        }

        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            bottom: 28px; right: 28px;
            padding: 12px 20px;
            background: #1e2433;
            color: #fff;
            border-radius: 12px;
            font-size: 0.88rem;
            font-weight: 600;
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s;
            pointer-events: none;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading-state {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 60px;
            color: var(--text-muted);
            gap: 10px;
        }
        .spinner {
            width: 22px; height: 22px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ì•ˆë‚´ ë°°ë„ˆ */
        .mule-tip-banner {
            background: linear-gradient(90deg, #fffbeb, #fff7f0);
            border: 1.5px solid #fed7aa;
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 18px;
            font-size: 0.82rem;
            color: #92400e;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .mule-tip-banner .tip-icon { font-size: 1.1rem; flex-shrink: 0; margin-top: 1px; }

        /* â”€â”€ ëŒ“ê¸€ ì˜ì—­ â”€â”€ */
        .comment-section {
            margin-top: 20px;
            padding-top: 18px;
            border-top: 1.5px solid var(--border-light);
        }
        .comment-section-title {
            font-size: 0.92rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 7px;
            margin-bottom: 16px;
        }
        .comment-count-badge {
            background: #e85d04;
            color: #fff;
            font-size: 0.72rem;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 99px;
            min-width: 22px;
            text-align: center;
        }

        /* ëŒ“ê¸€ ì‘ì„± í¼ */
        .comment-form {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
            background: #f8fafc;
            border: 1.5px solid var(--border);
            border-radius: 12px;
            padding: 14px;
        }
        .comment-form-row {
            display: flex;
            gap: 8px;
            align-items: flex-start;
        }
        .comment-author-input {
            width: 130px;
            flex-shrink: 0;
            padding: 8px 11px;
            border: 1.5px solid var(--border);
            border-radius: 8px;
            font-size: 0.84rem;
            color: var(--text-primary);
            background: #fff;
            outline: none;
        }
        .comment-author-input:focus { border-color: var(--accent); }
        .comment-textarea {
            flex: 1;
            padding: 8px 11px;
            border: 1.5px solid var(--border);
            border-radius: 8px;
            font-size: 0.84rem;
            color: var(--text-primary);
            background: #fff;
            resize: none;
            min-height: 64px;
            outline: none;
            font-family: inherit;
            line-height: 1.5;
        }
        .comment-textarea:focus { border-color: var(--accent); }
        .comment-submit-btn {
            align-self: flex-end;
            padding: 8px 18px;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 0.84rem;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
            transition: background 0.15s;
        }
        .comment-submit-btn:hover { background: #c24e03; }
        .comment-submit-btn:disabled { background: #ccc; cursor: not-allowed; }

        /* ëŒ“ê¸€ ëª©ë¡ */
        .comment-list { display: flex; flex-direction: column; gap: 2px; }

        /* ê°œë³„ ëŒ“ê¸€ */
        .comment-item {
            padding: 12px 14px;
            border-radius: 10px;
            background: #fff;
            border: 1px solid var(--border-light);
            transition: background 0.15s;
        }
        .comment-item:hover { background: #fafbff; }
        .comment-item.is-reply {
            margin-left: 32px;
            background: #f8fafc;
            border-left: 3px solid #e0e7ff;
        }
        .comment-item.is-reply:hover { background: #f0f4ff; }
        .comment-item.is-deleted .comment-body {
            color: var(--text-muted);
            font-style: italic;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }
        .comment-avatar {
            width: 28px; height: 28px;
            border-radius: 8px;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.85rem;
            font-weight: 700;
            color: #92400e;
            flex-shrink: 0;
        }
        .comment-item.is-reply .comment-avatar {
            background: linear-gradient(135deg, #e0e7ff, #c7d2fe);
            color: #3730a3;
        }
        .comment-author-name {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        .comment-date {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-left: 2px;
        }
        .comment-actions {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .comment-action-btn {
            padding: 3px 8px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: transparent;
            font-size: 0.72rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.15s;
            display: flex; align-items: center; gap: 3px;
        }
        .comment-action-btn:hover { border-color: var(--accent); color: var(--accent); }
        .comment-action-btn.like-active { border-color: #e85d04; color: #e85d04; background: #fff7f0; }
        .comment-action-btn.delete-btn:hover { border-color: #dc2626; color: #dc2626; background: #fff1f2; }

        .comment-body {
            font-size: 0.87rem;
            color: var(--text-secondary);
            line-height: 1.65;
            word-break: break-word;
            padding-left: 36px;
        }

        /* ëŒ€ëŒ“ê¸€ ì‘ì„± í¼ (ì¸ë¼ì¸ í† ê¸€) */
        .reply-form-wrap {
            margin-top: 8px;
            padding-left: 36px;
            display: none;
        }
        .reply-form-wrap.open { display: block; }
        .reply-form {
            display: flex;
            gap: 6px;
            align-items: flex-start;
            background: #f0f4ff;
            border: 1.5px solid #c7d2fe;
            border-radius: 10px;
            padding: 10px;
        }
        .reply-textarea {
            flex: 1;
            padding: 7px 10px;
            border: 1.5px solid #c7d2fe;
            border-radius: 7px;
            font-size: 0.82rem;
            color: var(--text-primary);
            background: #fff;
            resize: none;
            min-height: 52px;
            outline: none;
            font-family: inherit;
        }
        .reply-textarea:focus { border-color: #6366f1; }
        .reply-author-input {
            width: 110px;
            flex-shrink: 0;
            padding: 7px 10px;
            border: 1.5px solid #c7d2fe;
            border-radius: 7px;
            font-size: 0.82rem;
            background: #fff;
            outline: none;
        }
        .reply-author-input:focus { border-color: #6366f1; }
        .reply-btns {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .reply-submit-btn {
            padding: 6px 14px;
            background: #6366f1;
            color: #fff;
            border: none;
            border-radius: 7px;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
            transition: background 0.15s;
        }
        .reply-submit-btn:hover { background: #4f46e5; }
        .reply-cancel-btn {
            padding: 6px 14px;
            background: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border);
            border-radius: 7px;
            font-size: 0.8rem;
            cursor: pointer;
        }
        .reply-cancel-btn:hover { background: var(--bg-secondary); }

        /* ëŒ“ê¸€ ë¡œë”©/ë¹ˆ ìƒíƒœ */
        .comment-empty {
            text-align: center;
            padding: 24px;
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        .comment-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 20px;
            color: var(--text-muted);
            font-size: 0.84rem;
        }
        .comment-spinner {
            width: 16px; height: 16px;
            border: 2.5px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            flex-shrink: 0;
        }

        /* ê²Œì‹œê¸€ ì¹´ë“œ ëŒ“ê¸€ ìˆ˜ ë±ƒì§€ */
        .comment-cnt {
            display: flex; align-items: center; gap: 3px;
            color: var(--text-muted);
            font-size: 0.78rem;
        }
        .comment-cnt i { font-size: 0.72rem; }

        /* â”€â”€ ì»¤ë®¤ë‹ˆí‹° ë©”ì¸ ë ˆì´ì•„ì›ƒ (Grid 3ë‹¨) â”€â”€ */
        .comm-main-layout {
            display: grid;
            grid-template-columns: 200px minmax(0,1fr) 200px;
            gap: 18px;
            max-width: 1480px;
            margin: 0 auto;
            padding: 20px 20px 60px;
            align-items: start;
        }
        /* ê´‘ê³  ì»¬ëŸ¼ â”€â”€ sticky */
        .comm-main-layout > .gw-ad-col {
            width: 200px;
            min-width: 0;
            max-width: 200px;
            position: sticky;
            top: 76px;
            align-self: flex-start;
            z-index: 1;
            overflow: visible;
            flex-shrink: 0;
        }
        /* ê´‘ê³  ì¹´ë“œ í¬ê¸° í†µì¼ */
        .comm-main-layout > .gw-ad-col .gw-ad-card {
            width: 100% !important;
            max-width: 200px !important;
        }
        .comm-main-layout > .gw-ad-col .gw-ad-card img {
            width: 100% !important;
            height: 180px !important;
            object-fit: cover !important;
        }
        /* ì¤‘ì•™ ì½˜í…ì¸  ë˜í¼ â”€â”€ ì ˆëŒ€ ë„˜ì¹˜ì§€ ì•Šê²Œ */
        .comm-center-wrapper {
            min-width: 0;
            overflow: hidden;
        }
        /* ì»¤ë®¤ë‹ˆí‹° 3ë‹¨ ë ˆì´ì•„ì›ƒ ë°˜ì‘í˜• */
        @media (max-width: 1400px) {
            .comm-main-layout {
                grid-template-columns: 180px minmax(0,1fr) 180px;
            }
        }
        @media (max-width: 1100px) {
            .comm-main-layout {
                grid-template-columns: 160px minmax(0,1fr);
            }
            #commAdRight.gw-ad-col { display: none !important; }
        }
        @media (max-width: 900px) {
            .comm-main-layout {
                grid-template-columns: minmax(0,1fr);
                padding: 12px 10px 60px;
            }
            #commAdLeft.gw-ad-col  { display: none !important; }
            /* ëª¨ë°”ì¼ ê²Œì‹œê¸€ ì¹´ë“œ */
            .post-card { padding: 14px 14px; }
            .post-title { font-size: 0.97rem; white-space: normal; }
            .comm-center-wrapper {
                grid-template-columns: 1fr !important;
            }
            /* ê²€ìƒ‰ë°” */
            .search-bar input { font-size: 0.85rem; }
            /* ìƒë‹¨ íˆ´ë°” */
            .board-toolbar { flex-wrap: wrap; gap: 8px; }
        }
        /* â”€â”€ í™ˆ FAB ë²„íŠ¼ â”€â”€ */
        .home-fab{position:fixed;bottom:26px;left:26px;width:48px;height:48px;background:#d45d00;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.2rem;text-decoration:none;box-shadow:0 4px 16px rgba(212,93,0,.38);z-index:800;transition:background .18s,transform .18s;}
        .home-fab:hover{background:#b84e00;transform:scale(1.1);}
        .home-fab-tooltip{position:absolute;left:56px;top:50%;transform:translateY(-50%);background:#1e2433;color:#fff;font-size:.74rem;font-weight:700;padding:4px 11px;border-radius:8px;white-space:nowrap;opacity:0;pointer-events:none;transition:opacity .18s;}
        .home-fab:hover .home-fab-tooltip{opacity:1;}

        /* â”€â”€ í—¤ë” Auth ë²„íŠ¼ â”€â”€ */
        .header-auth-btns {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
        }
        .nav-btn--login {
            background: #fff7f0 !important;
            color: #e85d04 !important;
            border: 1.5px solid #fdba74 !important;
            font-weight: 700;
            padding: 7px 14px;
            border-radius: 8px;
            font-size: 0.84rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: background .18s;
        }
        .nav-btn--login:hover { background: #fff0e0 !important; }
        .nav-btn--logout {
            background: #f3f4f6 !important;
            color: #6b7280 !important;
            border: 1.5px solid #e5e7eb !important;
            font-weight: 600;
            padding: 7px 14px;
            border-radius: 8px;
            font-size: 0.84rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-family: inherit;
            transition: background .18s;
        }
        .nav-btn--logout:hover { background: #e5e7eb !important; }
        .header-profile-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.88rem;
            font-weight: 700;
            color: #e85d04;
            padding: 6px 10px;
            background: #fff7f0;
            border-radius: 8px;
            border: 1.5px solid #fdba74;
        }
        @media (max-width: 900px) {
            .header-auth-btns { display: none; }
        }
        .mobile-auth-area {
            border-top: 1px solid #e5e7eb;
            margin-top: 4px;
            padding-top: 4px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-inner">
            <a href="index.html" class="logo" aria-label="ì½”ë“œë•ì¿  í™ˆìœ¼ë¡œ ì´ë™">
                <i class="fas fa-guitar"></i>
                <div class="logo-textbox">
                    <span class="logo-text">Code<span class="accent">ducku</span></span>
                    <span class="logo-ko">ì½”ë“œë•ì¿ </span>
                </div>
            </a>
            <nav class="header-nav" id="headerNav">
                <a href="index.html" class="nav-btn nav-btn--accent"><i class="fas fa-music"></i> íƒ€ë¸Œ ìƒì„±</a>
                <a href="rehearsal.html" class="nav-btn nav-btn--blue"><i class="fas fa-drum"></i> í•©ì£¼ì‹¤</a>
                <a href="community.html" class="nav-btn nav-btn--orange"><i class="fas fa-users"></i> ì»¤ë®¤ë‹ˆí‹°</a>
                <a href="repair.html" class="nav-btn nav-btn--purple"><i class="fas fa-tools"></i> ë¦¬í˜ì–´ìƒµ</a>
                <a href="instrument.html" class="nav-btn nav-btn--teal"><i class="fas fa-guitar"></i> ì•…ê¸°ìƒµ</a>
                <a href="score.html" class="nav-btn nav-btn--violet"><i class="fas fa-file-pdf"></i> ì•…ë³´ê³µìœ </a>
            </nav>
            <!-- ë¡œê·¸ì¸/í”„ë¡œí•„ ë²„íŠ¼ -->
            <div class="header-auth-btns" id="headerAuthArea">
                <a href="login.html" class="nav-btn nav-btn--login" id="headerLoginBtn">
                    <i class="fas fa-sign-in-alt"></i> ë¡œê·¸ì¸
                </a>
                <span class="header-profile-btn" id="headerProfileBtn" style="display:none">
                    <i class="fas fa-user-circle"></i>
                    <span id="headerNickname">ë‹‰ë„¤ì„</span>
                </span>
                <button class="nav-btn nav-btn--logout" id="headerLogoutBtn" style="display:none" onclick="doLogout()">
                    <i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ
                </button>
            </div>
            <button class="hamburger-btn" id="hamburgerBtn" aria-label="ë©”ë‰´ ì—´ê¸°">
                <span></span><span></span><span></span>
            </button>
        </div>
        <div class="mobile-menu" id="mobileMenu">
            <a href="index.html" class="mobile-menu-item"><i class="fas fa-music"></i> íƒ€ë¸Œ ìƒì„±</a>
            <a href="rehearsal.html" class="mobile-menu-item"><i class="fas fa-drum"></i> í•©ì£¼ì‹¤</a>
            <a href="community.html" class="mobile-menu-item"><i class="fas fa-users"></i> ì»¤ë®¤ë‹ˆí‹°</a>
            <a href="repair.html" class="mobile-menu-item"><i class="fas fa-tools"></i> ë¦¬í˜ì–´ìƒµ</a>
            <a href="instrument.html" class="mobile-menu-item"><i class="fas fa-guitar"></i> ì•…ê¸°ìƒµ</a>
            <a href="score.html" class="mobile-menu-item"><i class="fas fa-file-pdf"></i> ì•…ë³´ê³µìœ </a>
            <div class="mobile-auth-area" id="mobileAuthArea">
                <a href="login.html" class="mobile-menu-item" id="mobileLoginBtn">
                    <i class="fas fa-sign-in-alt"></i> ë¡œê·¸ì¸ / íšŒì›ê°€ì…
                </a>
                <button class="mobile-menu-item" id="mobileLogoutBtn" style="display:none; background:none; border:none; width:100%; text-align:left; cursor:pointer;" onclick="doLogout()">
                    <i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ
                </button>
            </div>
        </div>
    </header>
    </header>

    <!-- ì»¤ë®¤ë‹ˆí‹° íˆì–´ë¡œ -->
    <div class="comm-hero">
        <div class="comm-hero-inner">
            <div class="comm-hero-icon">ğŸ¸</div>
            <div>
                <h1>ë®¤ì§€ì…˜ ì»¤ë®¤ë‹ˆí‹°</h1>
                <p>ë°´ë“œ êµ¬ì¸êµ¬ì§ Â· ê°œì¸ë ˆìŠ¨ Â· ì¤‘ê³ ì•…ê¸°ê±°ë˜ Â· ììœ ê²Œì‹œíŒ</p>
            </div>
            <div class="comm-stats">
                <div class="comm-stat-item">
                    <div class="num" id="totalPosts">-</div>
                    <div class="lbl">ì „ì²´ ê²Œì‹œê¸€</div>
                </div>
                <div class="comm-stat-item">
                    <div class="num" id="todayPosts">3</div>
                    <div class="lbl">ì˜¤ëŠ˜ ë“±ë¡</div>
                </div>
                <div class="comm-stat-item">
                    <div class="num">ğŸŸ¢</div>
                    <div class="lbl">í™œì„±</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ë ˆì´ì•„ì›ƒ (3ë‹¨: ê´‘ê³  | ì¹´í…Œê³ ë¦¬+ì½˜í…ì¸  | ê´‘ê³ ) -->
    <div class="comm-main-layout">
        <!-- ì¢Œì¸¡ ê´‘ê³  ì‚¬ì´ë“œë°” -->
        <div class="gw-ad-col gw-ad-left" id="commAdLeft"></div>

        <!-- ì‚¬ì´ë“œë°” + ì½˜í…ì¸  ë˜í¼ -->
        <div class="comm-center-wrapper" style="display:grid;grid-template-columns:180px minmax(0,1fr);gap:18px;">
        <aside class="comm-sidebar" style="position:sticky;top:20px;align-self:start;">
            <div class="sidebar-section">
                <h3>ì „ì²´ ë©”ë‰´</h3>
                <ul class="sidebar-menu" id="sideMenu">
                    <li><button data-cat="all" class="active"><i class="fas fa-home" style="width:16px;color:#e85d04"></i> ì „ì²´ê¸€ ë³´ê¸°</button></li>
                    <li><button data-cat="free_talk"><i class="fas fa-comment-dots" style="width:16px;color:#ca8a04"></i> ììœ ê²Œì‹œíŒ</button></li>
                    <li><button data-cat="info"><i class="fas fa-star" style="width:16px;color:#9333ea"></i> ì¥ë¹„ë¦¬ë·° / ì •ë³´</button></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <h3>ğŸ¸ ë°´ë“œ êµ¬ì¸êµ¬ì§</h3>
                <ul class="sidebar-menu">
                    <li><button data-cat="band_recruit" data-sub="all"><i class="fas fa-users" style="width:16px;color:#dc2626"></i> ì „ì²´ êµ¬ì¸êµ¬ì§</button></li>
                    <li><button data-cat="band_recruit" data-sub="guitarist"><i class="fas fa-guitar" style="width:16px;color:#dc2626"></i> ê¸°íƒ€ë¦¬ìŠ¤íŠ¸ ëª¨ì§‘</button></li>
                    <li><button data-cat="band_recruit" data-sub="bassist"><i class="fas fa-music" style="width:16px;color:#dc2626"></i> ë² ì´ì‹œìŠ¤íŠ¸ ëª¨ì§‘</button></li>
                    <li><button data-cat="band_recruit" data-sub="drummer"><i class="fas fa-drum" style="width:16px;color:#dc2626"></i> ë“œëŸ¬ë¨¸ ëª¨ì§‘</button></li>
                    <li><button data-cat="band_recruit" data-sub="vocalist"><i class="fas fa-microphone" style="width:16px;color:#dc2626"></i> ë³´ì»¬ë¦¬ìŠ¤íŠ¸ ëª¨ì§‘</button></li>
                    <li><button data-cat="band_recruit" data-sub="band_join"><i class="fas fa-user-plus" style="width:16px;color:#dc2626"></i> ë°´ë“œ ì°¾ìŠµë‹ˆë‹¤</button></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <h3>ğŸ“ ê°œì¸ ë ˆìŠ¨</h3>
                <ul class="sidebar-menu">
                    <li><button data-cat="lesson" data-sub="all"><i class="fas fa-chalkboard-teacher" style="width:16px;color:#2563eb"></i> ì „ì²´ ë ˆìŠ¨</button></li>
                    <li><button data-cat="lesson" data-sub="guitar"><i class="fas fa-guitar" style="width:16px;color:#2563eb"></i> ê¸°íƒ€ ë ˆìŠ¨</button></li>
                    <li><button data-cat="lesson" data-sub="bass"><i class="fas fa-music" style="width:16px;color:#2563eb"></i> ë² ì´ìŠ¤ ë ˆìŠ¨</button></li>
                    <li><button data-cat="lesson" data-sub="drum"><i class="fas fa-drum" style="width:16px;color:#2563eb"></i> ë“œëŸ¼ ë ˆìŠ¨</button></li>
                    <li><button data-cat="lesson" data-sub="vocal"><i class="fas fa-microphone-alt" style="width:16px;color:#2563eb"></i> ë³´ì»¬ ë ˆìŠ¨</button></li>
                </ul>
            </div>

            <div class="sidebar-section">
                <h3>ğŸ›’ ì¤‘ê³ ì¥í„°</h3>
                <ul class="sidebar-menu">
                    <li>
                        <button data-cat="used_gear" data-sub="all" id="usedAllBtn">
                            <i class="fas fa-shopping-bag" style="width:16px;color:#16a34a"></i> ì „ì²´ ì¤‘ê³ ì¥í„°
                        </button>
                    </li>
                    <li><button data-cat="used_gear" data-sub="acoustic"><i class="fas fa-guitar" style="width:16px;color:#16a34a"></i> ì–´ì¿ ìŠ¤í‹± ê¸°íƒ€</button></li>
                    <li><button data-cat="used_gear" data-sub="electric"><i class="fas fa-bolt" style="width:16px;color:#16a34a"></i> ì¼ë ‰ ê¸°íƒ€</button></li>
                    <li><button data-cat="used_gear" data-sub="bass"><i class="fas fa-music" style="width:16px;color:#16a34a"></i> ë² ì´ìŠ¤ ê¸°íƒ€</button></li>
                    <li><button data-cat="used_gear" data-sub="effector"><i class="fas fa-sliders-h" style="width:16px;color:#16a34a"></i> ì´í™í„°</button></li>
                    <li><button data-cat="used_gear" data-sub="drum"><i class="fas fa-drum" style="width:16px;color:#16a34a"></i> ë“œëŸ¼</button></li>
                    <li><button data-cat="used_gear" data-sub="pa"><i class="fas fa-volume-up" style="width:16px;color:#16a34a"></i> PA / ìŒí–¥</button></li>
                    <li><button data-cat="used_gear" data-sub="amp"><i class="fas fa-plug" style="width:16px;color:#16a34a"></i> ì•°í”„</button></li>
                    <li><button data-cat="used_gear" data-sub="etc"><i class="fas fa-ellipsis-h" style="width:16px;color:#16a34a"></i> ê¸°íƒ€ ìš©í’ˆ</button></li>
                </ul>
            </div>
        </aside>

        <!-- ì½˜í…ì¸  -->
        <main class="comm-content">
            <!-- ì•ˆë‚´ ë°°ë„ˆ -->
            <div class="mule-tip-banner">
                <span class="tip-icon">ğŸ’¡</span>
                <div>
                    <strong style="display:inline;font-weight:700;">ë®¤ì§€ì…˜ ì»¤ë®¤ë‹ˆí‹° ë² íƒ€ ì˜¤í”ˆ!</strong>
                    &nbsp;ë°´ë“œ êµ¬ì¸êµ¬ì§, ê°œì¸ë ˆìŠ¨ ë§¤ì¹­, ì¤‘ê³ ì•…ê¸° ê±°ë˜ê¹Œì§€! ê²Œì‹œê¸€ì„ ë“±ë¡í•´ë³´ì„¸ìš” ğŸ¸
                </div>
            </div>

            <!-- ìƒë‹¨ í•„í„° ë°” -->
            <div class="tab-filter-bar">
                <div class="category-title" id="categoryTitle">
                    <span class="icon-badge" style="background:#fff7f0;">ğŸ </span>
                    ì „ì²´ê¸€ ë³´ê¸°
                </div>
                <div class="filter-group">
                    <select class="filter-select" id="sortSelect">
                        <option value="latest">ìµœì‹ ìˆœ</option>
                        <option value="views">ì¡°íšŒìˆ˜ìˆœ</option>
                        <option value="likes">ì¢‹ì•„ìš”ìˆœ</option>
                    </select>
                    <button class="write-btn" id="writeBtn">
                        <i class="fas fa-pen"></i> ê¸€ì“°ê¸°
                    </button>
                </div>
            </div>

            <!-- ê²€ìƒ‰ ë°” -->
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="ì œëª©, ë‚´ìš©, ì‘ì„±ì ê²€ìƒ‰..." />
                <button id="searchBtn"><i class="fas fa-search"></i></button>
            </div>

            <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
            <div id="postContainer">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <span>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
                </div>
            </div>

            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
            <div class="pagination" id="pagination"></div>
        </main>
        </div><!-- /comm-center-wrapper -->

        <!-- ìš°ì¸¡ ê´‘ê³  ì‚¬ì´ë“œë°” -->
        <div class="gw-ad-col gw-ad-right" id="commAdRight"></div>
    </div>

    <!-- ê¸€ì“°ê¸° ëª¨ë‹¬ -->
    <div class="modal-overlay" id="writeModal">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-pen" style="color:var(--accent);margin-right:8px;"></i>ê²Œì‹œê¸€ ì‘ì„±</h2>
                <button class="modal-close" id="closeWriteModal">âœ•</button>
            </div>
            <div class="form-group">
                <label>ì¹´í…Œê³ ë¦¬ *</label>
                <select id="formCategory">
                    <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                    <option value="band_recruit">ğŸ¸ ë°´ë“œ êµ¬ì¸êµ¬ì§</option>
                    <option value="lesson">ğŸ“ ê°œì¸ ë ˆìŠ¨</option>
                    <option value="used_gear">ğŸ›’ ì¤‘ê³ ì¥í„°</option>
                    <option value="free_talk">ğŸ’¬ ììœ ê²Œì‹œíŒ</option>
                    <option value="info">â­ ì¥ë¹„ë¦¬ë·° / ì •ë³´</option>
                </select>
            </div>
            <div class="form-group" id="subCatGroup" style="display:none;">
                <label>ì„¸ë¶€ ì¹´í…Œê³ ë¦¬</label>
                <select id="formSubcategory"></select>
            </div>
            <div class="form-group">
                <label>ì œëª© *</label>
                <input type="text" id="formTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" />
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ì‘ì„±ì ë‹‰ë„¤ì„ *</label>
                    <input type="text" id="formAuthor" placeholder="ë‹‰ë„¤ì„" />
                </div>
                <div class="form-group">
                    <label>ì§€ì—­</label>
                    <input type="text" id="formLocation" placeholder="ì„œìš¸ ê°•ë‚¨êµ¬" />
                </div>
            </div>
            <div class="form-group" id="priceGroup" style="display:none;">
                <label>ê°€ê²© (ì›)</label>
                <input type="number" id="formPrice" placeholder="0" />
            </div>
            <div class="form-group" id="contactGroup" style="display:none;">
                <label>ì—°ë½ì²˜ / SNS</label>
                <input type="text" id="formContact" placeholder="ì¹´ì¹´ì˜¤í†¡ ID, ì¸ìŠ¤íƒ€ê·¸ë¨ ë“±" />
            </div>
            <div class="form-group">
                <label>ë‚´ìš© *</label>
                <textarea id="formContent" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            </div>
            <div class="form-group">
                <label>íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                <input type="text" id="formTags" placeholder="ê¸°íƒ€, ì…ë¬¸ì, ì„œìš¸ ..." />
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="cancelWrite">ì·¨ì†Œ</button>
                <button class="btn-submit" id="submitPost">ë“±ë¡í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ê²Œì‹œê¸€ ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal detail-modal">
            <div class="modal-header">
                <div id="detailCategoryBadge"></div>
                <button class="modal-close" id="closeDetailModal">âœ•</button>
            </div>
            <!-- ê²Œì‹œê¸€ ë³¸ë¬¸ -->
            <div id="detailContent"></div>

            <!-- â”€â”€ ëŒ“ê¸€ ì˜ì—­ â”€â”€ -->
            <div class="comment-section">
                <div class="comment-section-title">
                    <i class="fas fa-comments" style="color:var(--accent);"></i>
                    ëŒ“ê¸€
                    <span class="comment-count-badge" id="commentCountBadge">0</span>
                </div>

                <!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
                <div class="comment-form">
                    <div class="comment-form-row">
                        <input type="text" class="comment-author-input" id="newCommentAuthor" placeholder="ë‹‰ë„¤ì„" maxlength="20" />
                        <textarea class="comment-textarea" id="newCommentText" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”..." maxlength="500" rows="2"></textarea>
                    </div>
                    <div style="display:flex;justify-content:flex-end;gap:8px;align-items:center;">
                        <span id="newCommentCharCount" style="font-size:0.75rem;color:var(--text-muted);">0/500</span>
                        <button class="comment-submit-btn" id="submitCommentBtn">
                            <i class="fas fa-paper-plane"></i> ëŒ“ê¸€ ë“±ë¡
                        </button>
                    </div>
                </div>

                <!-- ëŒ“ê¸€ ëª©ë¡ -->
                <div id="commentList">
                    <div class="comment-loading">
                        <div class="comment-spinner"></div> ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-cancel" id="closeDetailBtn">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ -->
    <div class="toast" id="toast"></div>

    <!-- í™ˆ FAB ë²„íŠ¼ -->
    <a href="index.html" id="gw-home-fab" class="home-fab" title="í™ˆìœ¼ë¡œ">
        <i class="fas fa-home"></i>
        <span class="home-fab-tooltip">í™ˆìœ¼ë¡œ</span>
    </a>

    <!-- Supabase JS v2 (Auth) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/supabase.js"></script>
    <script>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ì½”ë“œë•ì¿  ì»¤ë®¤ë‹ˆí‹° v2.0 â€” Supabase ì—°ë™
       - ë°´ë“œ êµ¬ì¸êµ¬ì§ / ê°œì¸ë ˆìŠ¨ / ì¤‘ê³ ì¥í„° / ììœ ê²Œì‹œíŒ
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const API = 'community_posts'; // Supabase í…Œì´ë¸”ëª…

    // â”€â”€ Auth ì´ˆê¸°í™” â”€â”€
    let currentUser = null;
    let currentProfile = null;

    async function initAuth() {
        const session = await getSession();
        if (session) {
            currentUser = session.user;
            currentProfile = await getProfile(currentUser.id);
        }
        updateAuthUI();
    }

    function updateAuthUI() {
        const loginBtn   = document.getElementById('headerLoginBtn');
        const profileBtn = document.getElementById('headerProfileBtn');
        const logoutBtn  = document.getElementById('headerLogoutBtn');
        const nickSpan   = document.getElementById('headerNickname');
        const mobileLogin = document.getElementById('mobileLoginBtn');
        const mobileLogout = document.getElementById('mobileLogoutBtn');

        if (currentUser) {
            const nick = currentProfile?.nickname || currentUser.email.split('@')[0];
            if (loginBtn)   loginBtn.style.display   = 'none';
            if (profileBtn) { profileBtn.style.display = 'inline-flex'; nickSpan.textContent = nick; }
            if (logoutBtn)  logoutBtn.style.display  = 'inline-flex';
            if (mobileLogin)  mobileLogin.style.display  = 'none';
            if (mobileLogout) mobileLogout.style.display = 'block';
        } else {
            if (loginBtn)   loginBtn.style.display   = 'inline-flex';
            if (profileBtn) profileBtn.style.display = 'none';
            if (logoutBtn)  logoutBtn.style.display  = 'none';
            if (mobileLogin)  mobileLogin.style.display  = 'block';
            if (mobileLogout) mobileLogout.style.display = 'none';
        }
    }

    async function doLogout() {
        await signOut();
        currentUser = null;
        currentProfile = null;
        updateAuthUI();
        showToast('ğŸ‘‹ ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    const CATEGORY_INFO = {
        all:        { label: 'ì „ì²´ê¸€ ë³´ê¸°',       icon: 'ğŸ ', badge: 'badge-talk' },
        band_recruit:{ label: 'ë°´ë“œ êµ¬ì¸êµ¬ì§',     icon: 'ğŸ¸', badge: 'badge-band' },
        lesson:     { label: 'ê°œì¸ ë ˆìŠ¨',         icon: 'ğŸ“', badge: 'badge-lesson' },
        used_gear:  { label: 'ì¤‘ê³ ì¥í„°',           icon: 'ğŸ›’', badge: 'badge-used' },
        free_talk:  { label: 'ììœ ê²Œì‹œíŒ',         icon: 'ğŸ’¬', badge: 'badge-talk' },
        info:       { label: 'ì¥ë¹„ë¦¬ë·° / ì •ë³´',    icon: 'â­', badge: 'badge-info' },
    };

    const SUBCATEGORY_OPTIONS = {
        band_recruit: [
            { value: 'all', label: 'ì „ì²´' },
            { value: 'guitarist', label: 'ê¸°íƒ€ë¦¬ìŠ¤íŠ¸ ëª¨ì§‘' },
            { value: 'bassist', label: 'ë² ì´ì‹œìŠ¤íŠ¸ ëª¨ì§‘' },
            { value: 'drummer', label: 'ë“œëŸ¬ë¨¸ ëª¨ì§‘' },
            { value: 'vocalist', label: 'ë³´ì»¬ë¦¬ìŠ¤íŠ¸ ëª¨ì§‘' },
            { value: 'keyboardist', label: 'í‚¤ë³´ë””ìŠ¤íŠ¸ ëª¨ì§‘' },
            { value: 'band_join', label: 'ë°´ë“œ ì°¾ìŠµë‹ˆë‹¤' },
        ],
        lesson: [
            { value: 'all', label: 'ì „ì²´' },
            { value: 'guitar', label: 'ê¸°íƒ€ ë ˆìŠ¨' },
            { value: 'bass', label: 'ë² ì´ìŠ¤ ë ˆìŠ¨' },
            { value: 'drum', label: 'ë“œëŸ¼ ë ˆìŠ¨' },
            { value: 'vocal', label: 'ë³´ì»¬ ë ˆìŠ¨' },
            { value: 'keyboard', label: 'ê±´ë°˜ ë ˆìŠ¨' },
        ],
        used_gear: [
            { value: 'all', label: 'ì „ì²´' },
            { value: 'acoustic', label: 'ì–´ì¿ ìŠ¤í‹± ê¸°íƒ€' },
            { value: 'electric', label: 'ì¼ë ‰ ê¸°íƒ€' },
            { value: 'bass', label: 'ë² ì´ìŠ¤ ê¸°íƒ€' },
            { value: 'effector', label: 'ì´í™í„°' },
            { value: 'drum', label: 'ë“œëŸ¼' },
            { value: 'pa', label: 'PA / ìŒí–¥' },
            { value: 'amp', label: 'ì•°í”„' },
            { value: 'etc', label: 'ê¸°íƒ€ ìš©í’ˆ' },
        ],
        free_talk: [], info: [],
    };

    const GEAR_ICON = {
        acoustic: 'ğŸ¸', electric: 'âš¡', bass: 'ğŸµ',
        effector: 'ğŸ›ï¸', drum: 'ğŸ¥', pa: 'ğŸ”Š', amp: 'ğŸ”Œ', etc: 'ğŸ¼'
    };

    // â”€â”€ ìƒíƒœ â”€â”€
    let state = {
        category: 'all',
        subcategory: 'all',
        sort: 'latest',
        search: '',
        page: 1,
        totalPages: 1,
        posts: [],
    };

    // â”€â”€ ì¹´í…Œê³ ë¦¬ë³„ ê´‘ê³  ë§¤í•‘ (ê° ì‚¬ì´ë“œ 4ê°œì”©) â”€â”€
    const COMM_AD_MAP = {
        all:          { left: ['COMM_ALL_L1','COMM_ALL_L2','COMM_ALL_L3','COMM_ALL_L4'],       right: ['COMM_ALL_R1','COMM_ALL_R2','COMM_ALL_R3','COMM_ALL_R4']       },
        band_recruit: { left: ['COMM_BAND_L1','COMM_BAND_L2','COMM_BAND_L3','COMM_BAND_L4'],   right: ['COMM_BAND_R1','COMM_BAND_R2','COMM_BAND_R3','COMM_BAND_R4']   },
        lesson:       { left: ['COMM_LESSON_L1','COMM_LESSON_L2','COMM_LESSON_L3','COMM_LESSON_L4'], right: ['COMM_LESSON_R1','COMM_LESSON_R2','COMM_LESSON_R3','COMM_LESSON_R4'] },
        used_gear:    { left: ['COMM_USED_L1','COMM_USED_L2','COMM_USED_L3','COMM_USED_L4'],   right: ['COMM_USED_R1','COMM_USED_R2','COMM_USED_R3','COMM_USED_R4']   },
        free_talk:    { left: ['COMM_FREE_L1','COMM_FREE_L2','COMM_FREE_L3','COMM_FREE_L4'],   right: ['COMM_FREE_R1','COMM_FREE_R2','COMM_FREE_R3','COMM_FREE_R4']   },
        info:         { left: ['COMM_INFO_L1','COMM_INFO_L2','COMM_INFO_L3','COMM_INFO_L4'],   right: ['COMM_INFO_R1','COMM_INFO_R2','COMM_INFO_R3','COMM_INFO_R4']   },
    };

    function updateCommAds(cat) {
        const map = COMM_AD_MAP[cat] || COMM_AD_MAP.all;
        if (typeof mountAds === 'function') {
            mountAds('commAdLeft',  map.left);
            mountAds('commAdRight', map.right);
        }
    }

    // â”€â”€ ì¦‰ì‹œ ì‹¤í–‰ (ì½”ë“œ ë¡œë“œ ì§í›„) â”€â”€
    setupSideMenu();
    setupWriteModal();
    setupDetailModal();
    loadPosts();
    updateTotalCount();
    updateCommAds('all');

    // â”€â”€â”€ ì‚¬ì´ë“œ ë©”ë‰´ â”€â”€â”€
    function setupSideMenu() {
        document.querySelectorAll('#sideMenu button, .sidebar-section button[data-cat]').forEach(btn => {
            btn.addEventListener('click', () => {
                const cat = btn.dataset.cat;
                const sub = btn.dataset.sub || 'all';
                state.category = cat;
                state.subcategory = sub;
                state.page = 1;
                state.search = '';
                document.getElementById('searchInput').value = '';
                updateCategoryTitle(cat, sub);
                setActiveMenuBtn(btn);
                loadPosts();
                updateCommAds(cat); // ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì‹œ ê´‘ê³  ê°±ì‹ 
            });
        });
        document.getElementById('sortSelect').addEventListener('change', e => {
            state.sort = e.target.value;
            loadPosts();
        });
        document.getElementById('searchBtn').addEventListener('click', doSearch);
        document.getElementById('searchInput').addEventListener('keydown', e => {
            if (e.key === 'Enter') doSearch();
        });
    }

    function setActiveMenuBtn(active) {
        document.querySelectorAll('.sidebar-section button[data-cat]').forEach(b => b.classList.remove('active'));
        active.classList.add('active');
    }

    function doSearch() {
        state.search = document.getElementById('searchInput').value.trim();
        state.page = 1;
        loadPosts();
    }

    function updateCategoryTitle(cat, sub) {
        const info = CATEGORY_INFO[cat] || CATEGORY_INFO.all;
        let label = info.label;
        if (sub && sub !== 'all' && SUBCATEGORY_OPTIONS[cat]) {
            const found = SUBCATEGORY_OPTIONS[cat].find(o => o.value === sub);
            if (found) label = found.label;
        }
        document.getElementById('categoryTitle').innerHTML = `
            <span class="icon-badge" style="background:#fff7f0;">${info.icon}</span>
            ${label}
        `;
    }

    // â”€â”€â”€ ë°ì´í„° ë¡œë“œ â”€â”€â”€
    async function loadPosts() {
        const container = document.getElementById('postContainer');
        container.innerHTML = '<div class="loading-state"><div class="spinner"></div><span>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span></div>';

        try {
            const limit = 12;
            const result = await SupabaseDB.list('community_posts', {
                limit: 200,
                page: 1,
                search: state.search,
                searchFields: ['title','content','author'],
                sort: 'created_at',
                order: 'desc',
            });
            const data = result;
            let posts = data.data || [];

            // ì¹´í…Œê³ ë¦¬ í•„í„° (í´ë¼ì´ì–¸íŠ¸ ì¸¡)
            if (state.category !== 'all') {
                posts = posts.filter(p => p.category === state.category);
            }
            if (state.subcategory && state.subcategory !== 'all') {
                posts = posts.filter(p => p.subcategory === state.subcategory);
            }

            // ì •ë ¬
            if (state.sort === 'views') {
                posts.sort((a, b) => (b.views || 0) - (a.views || 0));
            } else if (state.sort === 'likes') {
                posts.sort((a, b) => (b.likes || 0) - (a.likes || 0));
            } else {
                posts.sort((a, b) => (b.created_at || 0) - (a.created_at || 0));
            }

            state.posts = posts;
            state.totalPages = Math.ceil(posts.length / limit) || 1;

            renderPosts(posts);
            renderPagination();
        } catch (e) {
            container.innerHTML = `<div class="empty-state"><div class="empty-icon">âš ï¸</div><p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p></div>`;
        }
    }

    async function updateTotalCount() {
        try {
            const result = await SupabaseDB.list('community_posts', { limit: 1 });
            document.getElementById('totalPosts').textContent = result.total || 0;
        } catch { document.getElementById('totalPosts').textContent = '-'; }
    }

    // â”€â”€â”€ ë Œë”ë§ â”€â”€â”€
    function renderPosts(posts) {
        const container = document.getElementById('postContainer');
        if (!posts || posts.length === 0) {
            container.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“­</div><p>ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì²« ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</p></div>`;
            return;
        }

        const cat = state.category;

        if (cat === 'used_gear') {
            container.innerHTML = `<div class="gear-grid">${posts.map(renderGearCard).join('')}</div>`;
        } else if (cat === 'lesson') {
            container.innerHTML = `<div class="lesson-grid">${posts.map(renderLessonCard).join('')}</div>`;
        } else if (cat === 'band_recruit') {
            container.innerHTML = `<div class="recruit-grid">${posts.map(renderRecruitCard).join('')}</div>`;
        } else {
            container.innerHTML = `<div class="post-list">${posts.map(renderPostCard).join('')}</div>`;
        }

        // í´ë¦­ ì´ë²¤íŠ¸
        container.querySelectorAll('[data-post-id]').forEach(el => {
            el.addEventListener('click', () => openDetail(el.dataset.postId));
        });

        // ì¹´ë“œë³„ ëŒ“ê¸€ ìˆ˜ ë¹„ë™ê¸° ë¡œë“œ
        loadCommentCounts(posts.map(p => p.id));
    }

    // â”€â”€â”€ ì¹´ë“œ ëŒ“ê¸€ ìˆ˜ ë¹„ë™ê¸° ì±„ìš°ê¸° â”€â”€â”€
    async function loadCommentCounts(postIds) {
        if (!postIds || postIds.length === 0) return;
        try {
            const res = await fetch(`${COMMENT_API}?limit=500`);
            if (!res.ok) return;
            const data = await res.json();
            const all = (data.data || []).filter(c => !c.is_deleted);

            // postId ë³„ ì¹´ìš´íŠ¸
            const countMap = {};
            all.forEach(c => {
                if (!countMap[c.post_id]) countMap[c.post_id] = 0;
                countMap[c.post_id]++;
            });

            // ê° ì¹´ë“œ ì—…ë°ì´íŠ¸
            postIds.forEach(pid => {
                const cnt = countMap[pid] || 0;
                const el = document.querySelector(`[data-post-id="${pid}"] .comment-cnt-val`);
                if (el) el.textContent = cnt;
            });
        } catch { /* silent */ }
    }

    function getCategoryBadge(cat, sub) {
        const info = CATEGORY_INFO[cat] || {};
        const cls = info.badge || 'badge-talk';
        let label = info.label || cat;
        if (sub && sub !== 'all' && SUBCATEGORY_OPTIONS[cat]) {
            const f = SUBCATEGORY_OPTIONS[cat].find(o => o.value === sub);
            if (f) label = f.label;
        }
        return `<span class="post-category-badge ${cls}">${label}</span>`;
    }

    function fmtPrice(p) {
        if (!p) return '';
        return Number(p).toLocaleString('ko-KR') + 'ì›';
    }

    function fmtDate(ts) {
        if (!ts) return '';
        const d = new Date(ts);
        const now = new Date();
        const diff = Math.floor((now - d) / 60000);
        if (diff < 1) return 'ë°©ê¸ˆ';
        if (diff < 60) return `${diff}ë¶„ ì „`;
        if (diff < 1440) return `${Math.floor(diff/60)}ì‹œê°„ ì „`;
        return d.toLocaleDateString('ko-KR', { month: '2-digit', day: '2-digit' });
    }

    function renderPostCard(p) {
        const tags = Array.isArray(p.tags) ? p.tags.slice(0, 3).map(t => `<span class="tag">#${t}</span>`).join('') : '';
        const priceHtml = p.price ? `<span class="post-price">${fmtPrice(p.price)}</span>` : '';
        return `
        <div class="post-card" data-post-id="${p.id}">
            <div class="post-card-top">
                ${getCategoryBadge(p.category, p.subcategory)}
                <div class="post-title-area">
                    <div class="post-title">${escHtml(p.title || '')}</div>
                    <div class="post-preview">${escHtml((p.content || '').replace(/<[^>]+>/g, '').slice(0, 60))}...</div>
                </div>
                ${priceHtml}
            </div>
            ${tags ? `<div class="post-tags">${tags}</div>` : ''}
            <div class="post-meta">
                <span><i class="fas fa-user"></i> ${escHtml(p.author || 'ìµëª…')}</span>
                ${p.location ? `<span><i class="fas fa-map-marker-alt"></i> ${escHtml(p.location)}</span>` : ''}
                <span class="meta-views"><i class="fas fa-eye"></i> ${p.views || 0}</span>
                <span><i class="fas fa-heart"></i> ${p.likes || 0}</span>
                <span class="comment-cnt"><i class="fas fa-comment"></i> <span class="comment-cnt-val">0</span></span>
                <span class="meta-date"><i class="fas fa-clock"></i> ${fmtDate(p.created_at)}</span>
            </div>
        </div>`;
    }

    function renderGearCard(p) {
        const icon = GEAR_ICON[p.subcategory] || 'ğŸ¼';
        const bgColor = p.subcategory === 'acoustic' ? '#fef9c3' :
                        p.subcategory === 'electric' ? '#dbeafe' :
                        p.subcategory === 'bass' ? '#dcfce7' :
                        p.subcategory === 'effector' ? '#f3e8ff' :
                        p.subcategory === 'drum' ? '#fff1f2' :
                        p.subcategory === 'pa' ? '#fff7ed' : '#f0f9ff';
        const statusBadge = p.status === 'sold'
            ? `<span class="gear-status-badge status-sold">íŒë§¤ì™„ë£Œ</span>`
            : `<span class="gear-status-badge status-active">íŒë§¤ì¤‘</span>`;
        return `
        <div class="gear-card" data-post-id="${p.id}">
            <div class="gear-card-img" style="background:linear-gradient(135deg, ${bgColor}, #f8fafc);">
                <span class="subcategory-icon">${icon}</span>
                ${statusBadge}
            </div>
            <div class="gear-card-body">
                <div class="gear-card-title">${escHtml(p.title || '')}</div>
                <div class="gear-card-author"><i class="fas fa-user" style="font-size:0.72rem;"></i> ${escHtml(p.author || 'ìµëª…')}  Â·  ${p.location ? escHtml(p.location) : ''}</div>
                <div class="gear-card-price">${fmtPrice(p.price)}</div>
                <div class="gear-card-meta">
                    <span><i class="fas fa-eye"></i> ${p.views || 0}</span>
                    <span class="comment-cnt"><i class="fas fa-comment"></i> <span class="comment-cnt-val">0</span></span>
                    <span><i class="fas fa-clock"></i> ${fmtDate(p.created_at)}</span>
                </div>
            </div>
        </div>`;
    }

    function renderLessonCard(p) {
        const sub = SUBCATEGORY_OPTIONS.lesson.find(o => o.value === p.subcategory);
        const subLabel = sub ? sub.label : 'ë ˆìŠ¨';
        const icons = { guitar: 'ğŸ¸', bass: 'ğŸµ', drum: 'ğŸ¥', vocal: 'ğŸ¤', keyboard: 'ğŸ¹' };
        const icon = icons[p.subcategory] || 'ğŸ“';
        return `
        <div class="lesson-card" data-post-id="${p.id}">
            <div class="lesson-card-header">
                <div class="lesson-avatar">${icon}</div>
                <div>
                    <div class="lesson-card-title">${escHtml(p.title || '')}</div>
                    <div class="lesson-card-author"><i class="fas fa-user"></i> ${escHtml(p.author || 'ìµëª…')} Â· ${p.location ? escHtml(p.location) : ''}</div>
                </div>
            </div>
            <div class="lesson-card-desc">${escHtml((p.content || '').replace(/<[^>]+>/g, ''))}</div>
            <div class="lesson-price-row">
                <div class="lesson-price">${p.price ? fmtPrice(p.price) + '/íšŒ' : 'í˜‘ì˜'}</div>
                <div style="display:flex;align-items:center;gap:8px;">
                    <span class="comment-cnt" style="font-size:0.75rem;"><i class="fas fa-comment"></i> <span class="comment-cnt-val">0</span></span>
                    <span class="lesson-badge">${subLabel}</span>
                </div>
            </div>
        </div>`;
    }

    function renderRecruitCard(p) {
        const sub = SUBCATEGORY_OPTIONS.band_recruit.find(o => o.value === p.subcategory);
        const subLabel = sub ? sub.label : 'êµ¬ì¸';
        const icons = { guitarist: 'ğŸ¸', bassist: 'ğŸµ', drummer: 'ğŸ¥', vocalist: 'ğŸ¤', keyboardist: 'ğŸ¹', band_join: 'ğŸ”' };
        const icon = icons[p.subcategory] || 'ğŸ¸';
        const tags = Array.isArray(p.tags) ? p.tags.slice(0, 3).map(t =>
            `<span class="recruit-tag">${escHtml(t)}</span>`).join('') : '';
        const locTag = p.location ? `<span class="recruit-location"><i class="fas fa-map-marker-alt"></i> ${escHtml(p.location)}</span>` : '';
        return `
        <div class="recruit-card" data-post-id="${p.id}">
            <div class="recruit-header">
                <div class="recruit-icon">${icon}</div>
                <div>
                    <div class="recruit-title">${escHtml(p.title || '')}</div>
                    <div class="recruit-author">${escHtml(p.author || 'ìµëª…')} Â· <i class="fas fa-eye"></i> ${p.views || 0} Â· ${fmtDate(p.created_at)}</div>
                </div>
            </div>
            <div class="recruit-body">${escHtml((p.content || '').replace(/<[^>]+>/g, ''))}</div>
            <div class="recruit-footer">${tags}${locTag}</div>
            <div style="padding-top:8px;">
                <span class="comment-cnt"><i class="fas fa-comment"></i> <span class="comment-cnt-val">0</span> ëŒ“ê¸€</span>
            </div>
        </div>`;
    }

    // â”€â”€â”€ í˜ì´ì§€ë„¤ì´ì…˜ â”€â”€â”€
    function renderPagination() {
        const pg = document.getElementById('pagination');
        if (state.totalPages <= 1) { pg.innerHTML = ''; return; }
        let html = '';
        for (let i = 1; i <= Math.min(state.totalPages, 10); i++) {
            html += `<button class="page-btn${i === state.page ? ' active' : ''}" data-page="${i}">${i}</button>`;
        }
        pg.innerHTML = html;
        pg.querySelectorAll('.page-btn').forEach(b => {
            b.addEventListener('click', () => {
                state.page = parseInt(b.dataset.page);
                loadPosts();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
    }

    // â”€â”€â”€ ê²Œì‹œê¸€ ìƒì„¸ â”€â”€â”€
    function openDetail(postId) {
        const p = state.posts.find(x => x.id === postId);
        if (!p) return;

        const info = CATEGORY_INFO[p.category] || {};
        const badge = getCategoryBadge(p.category, p.subcategory);
        document.getElementById('detailCategoryBadge').innerHTML = badge;

        const tags = Array.isArray(p.tags) ? p.tags.map(t => `<span class="tag">#${t}</span>`).join('') : '';
        const priceHtml = p.price ? `
            <div class="detail-price-box">
                <div class="price-lbl">ğŸ’° íŒë§¤ê°€ê²©</div>
                <div class="price-val">${fmtPrice(p.price)}</div>
            </div>` : '';
        const contactHtml = p.contact ? `
            <div class="detail-contact">
                <strong><i class="fas fa-phone"></i> ì—°ë½ì²˜</strong>
                ${escHtml(p.contact)}
            </div>` : '';

        document.getElementById('detailContent').innerHTML = `
            <div class="detail-title">${escHtml(p.title || '')}</div>
            <div class="detail-meta">
                <span><i class="fas fa-user"></i> ${escHtml(p.author || 'ìµëª…')}</span>
                ${p.location ? `<span><i class="fas fa-map-marker-alt"></i> ${escHtml(p.location)}</span>` : ''}
                <span><i class="fas fa-eye"></i> ${p.views || 0}</span>
                <span><i class="fas fa-heart"></i> ${p.likes || 0}</span>
                <span><i class="fas fa-clock"></i> ${fmtDate(p.created_at)}</span>
            </div>
            ${priceHtml}
            <div class="detail-body">${escHtml((p.content || '').replace(/<[^>]+>/g, ''))}</div>
            ${tags ? `<div class="detail-tags">${tags}</div>` : ''}
            ${contactHtml}
        `;

        document.getElementById('detailModal').classList.add('open');
        // ì¡°íšŒìˆ˜ ì¦ê°€
        incrementViews(p.id, p.views || 0);
        // ëŒ“ê¸€ ë¡œë“œ
        loadComments(p.id);
    }

    async function incrementViews(id, currentViews) {
        try {
            await SupabaseDB.update('community_posts', id, { views: currentViews + 1 });
        } catch {}
    }

    function setupDetailModal() {
        document.getElementById('closeDetailModal').addEventListener('click', () => {
            document.getElementById('detailModal').classList.remove('open');
        });
        document.getElementById('closeDetailBtn').addEventListener('click', () => {
            document.getElementById('detailModal').classList.remove('open');
        });
        document.getElementById('detailModal').addEventListener('click', e => {
            if (e.target === e.currentTarget) e.currentTarget.classList.remove('open');
        });
        // ëŒ“ê¸€ ê¸°ëŠ¥ ì´ˆê¸°í™”
        setupComments();
    }

    // â”€â”€â”€ ê¸€ì“°ê¸° ëª¨ë‹¬ â”€â”€â”€
    function setupWriteModal() {
        document.getElementById('writeBtn').addEventListener('click', openWriteModal);
        document.getElementById('closeWriteModal').addEventListener('click', closeWriteModal);
        document.getElementById('cancelWrite').addEventListener('click', closeWriteModal);
        document.getElementById('writeModal').addEventListener('click', e => {
            if (e.target === e.currentTarget) closeWriteModal();
        });
        document.getElementById('formCategory').addEventListener('change', onCategoryChange);
        document.getElementById('submitPost').addEventListener('click', submitPost);
    }

    function openWriteModal() {
        // ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸
        if (!currentUser) {
            showToast('âœ‹ ê¸€ì“°ê¸°ëŠ” ë¡œê·¸ì¸ í›„ ì´ìš©í•  ìˆ˜ ìˆì–´ìš”!');
            setTimeout(() => { location.href = 'login.html?redirect=community.html'; }, 1200);
            return;
        }
        // í˜„ì¬ ì¹´í…Œê³ ë¦¬ ê¸°ë³¸ê°’ ì„¤ì •
        if (state.category !== 'all') {
            document.getElementById('formCategory').value = state.category;
            onCategoryChange();
        }
        // ë‹‰ë„¤ì„ ìë™ ì…ë ¥
        const authorField = document.getElementById('formAuthor');
        if (authorField && currentProfile?.nickname) {
            authorField.value = currentProfile.nickname;
            authorField.readOnly = true;
        }
        document.getElementById('writeModal').classList.add('open');
    }

    function closeWriteModal() {
        document.getElementById('writeModal').classList.remove('open');
        resetWriteForm();
    }

    function resetWriteForm() {
        ['formCategory','formTitle','formAuthor','formLocation','formPrice','formContact','formContent','formTags']
            .forEach(id => { const el = document.getElementById(id); if (el) el.value = ''; });
        document.getElementById('subCatGroup').style.display = 'none';
        document.getElementById('priceGroup').style.display = 'none';
        document.getElementById('contactGroup').style.display = 'none';
    }

    function onCategoryChange() {
        const cat = document.getElementById('formCategory').value;
        const subGrp = document.getElementById('subCatGroup');
        const priceGrp = document.getElementById('priceGroup');
        const contactGrp = document.getElementById('contactGroup');

        // ì„œë¸Œì¹´í…Œê³ ë¦¬
        const opts = SUBCATEGORY_OPTIONS[cat];
        if (opts && opts.length > 0) {
            const subSel = document.getElementById('formSubcategory');
            subSel.innerHTML = opts.map(o => `<option value="${o.value}">${o.label}</option>`).join('');
            subGrp.style.display = 'block';
        } else {
            subGrp.style.display = 'none';
        }

        // ê°€ê²© í•„ë“œ
        priceGrp.style.display = (cat === 'used_gear') ? 'block' : 'none';
        // ì—°ë½ì²˜
        contactGrp.style.display = (cat === 'lesson' || cat === 'band_recruit') ? 'block' : 'none';
    }

    async function submitPost() {
        const cat    = document.getElementById('formCategory').value;
        const title  = document.getElementById('formTitle').value.trim();
        const author = document.getElementById('formAuthor').value.trim();
        const content= document.getElementById('formContent').value.trim();

        if (!cat || !title || !author || !content) {
            showToast('âš ï¸ ì¹´í…Œê³ ë¦¬, ì œëª©, ì‘ì„±ì, ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        const subSel = document.getElementById('formSubcategory');
        const subcat = subSel && document.getElementById('subCatGroup').style.display !== 'none'
            ? subSel.value : '';
        const location= document.getElementById('formLocation').value.trim();
        const price   = document.getElementById('priceGroup').style.display !== 'none'
            ? parseInt(document.getElementById('formPrice').value) || 0 : 0;
        const contact = document.getElementById('formContact').value.trim();
        const tagsRaw = document.getElementById('formTags').value.trim();
        const tags    = tagsRaw ? tagsRaw.split(',').map(t => t.trim()).filter(Boolean) : [];

        const btn = document.getElementById('submitPost');
        btn.disabled = true;
        btn.textContent = 'ë“±ë¡ ì¤‘...';

        try {
            await SupabaseDB.create('community_posts', {
                category: cat,
                subcategory: subcat,
                title, author, content, location,
                price: price || null,
                contact: contact || null,
                tags,
                views: 0,
                likes: 0,
                status: 'active'
            });

            closeWriteModal();
            showToast('âœ… ê²Œì‹œê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ë¡œ ì´ë™
            state.category = cat;
            state.subcategory = 'all';
            state.page = 1;
            updateCategoryTitle(cat, 'all');
            loadPosts();
            updateTotalCount();
        } catch {
            showToast('âŒ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        } finally {
            btn.disabled = false;
            btn.textContent = 'ë“±ë¡í•˜ê¸°';
        }
    }

    // â”€â”€â”€ ìœ í‹¸ â”€â”€â”€
    function escHtml(str) {
        return String(str)
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;');
    }

    let _toastTimer;
    function showToast(msg) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.classList.add('show');
        clearTimeout(_toastTimer);
        _toastTimer = setTimeout(() => t.classList.remove('show'), 3000);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ëŒ“ê¸€ ê¸°ëŠ¥ v1.0
       - ëŒ“ê¸€ ëª©ë¡ ë¡œë“œ / ë“±ë¡ / ì‚­ì œ / ëŒ€ëŒ“ê¸€ / ì¢‹ì•„ìš”
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const COMMENT_API = 'community_comments'; // Supabase í…Œì´ë¸”ëª…

    // í˜„ì¬ ì—´ë¦° ê²Œì‹œê¸€ ID
    let _currentPostId = null;
    // ëŒ“ê¸€ ìºì‹œ: { [postId]: [commentObj, ...] }
    const _commentCache = {};

    // â”€â”€â”€ ëŒ“ê¸€ ì´ˆê¸°í™” (setupDetailModal ì—ì„œ í˜¸ì¶œ) â”€â”€â”€
    function setupComments() {
        // ëŒ“ê¸€ ë“±ë¡ ë²„íŠ¼
        document.getElementById('submitCommentBtn').addEventListener('click', submitComment);

        // ì—”í„°(Ctrl+Enter) ë‹¨ì¶•í‚¤
        document.getElementById('newCommentText').addEventListener('keydown', e => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') submitComment();
        });

        // ê¸€ììˆ˜ ì¹´ìš´í„°
        document.getElementById('newCommentText').addEventListener('input', () => {
            const len = document.getElementById('newCommentText').value.length;
            document.getElementById('newCommentCharCount').textContent = `${len}/500`;
        });
    }

    // â”€â”€â”€ ëŒ“ê¸€ ë¡œë“œ â”€â”€â”€
    async function loadComments(postId) {
        _currentPostId = postId;
        const listEl = document.getElementById('commentList');
        const badgeEl = document.getElementById('commentCountBadge');

        listEl.innerHTML = '<div class="comment-loading"><div class="comment-spinner"></div> ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
        badgeEl.textContent = 'â€¦';

        try {
            // Supabase: post_id í•„í„°ë¥¼ ì„œë²„ì—ì„œ ì²˜ë¦¬
            const result = await SupabaseDB.list('community_comments', {
                limit: 500,
                filters: { post_id: postId },
                sort: 'created_at',
                order: 'asc',
            });
            // ì‚­ì œë˜ì§€ ì•Šì€ ëŒ“ê¸€ë§Œ
            const all = (result.data || []).filter(c => !c.is_deleted);

            _commentCache[postId] = all;
            renderComments(all, postId);

            // ë±ƒì§€
            const total = all.length;
            badgeEl.textContent = total;
        } catch {
            listEl.innerHTML = '<div class="comment-empty">ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>';
            badgeEl.textContent = '0';
        }
    }

    // â”€â”€â”€ ëŒ“ê¸€ ë Œë”ë§ â”€â”€â”€
    function renderComments(comments, postId) {
        const listEl = document.getElementById('commentList');

        if (!comments || comments.length === 0) {
            listEl.innerHTML = '<div class="comment-empty">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”! ğŸ’¬</div>';
            return;
        }

        // ë¶€ëª¨/ìì‹ êµ¬ì¡° ë¶„ë¦¬
        const roots   = comments.filter(c => !c.parent_id);
        const replies  = comments.filter(c =>  c.parent_id);

        let html = '<div class="comment-list">';
        roots.forEach(root => {
            html += buildCommentHTML(root, false);
            // ì´ ëŒ“ê¸€ì— ë‹¬ë¦° ëŒ€ëŒ“ê¸€
            const children = replies.filter(r => r.parent_id === root.id);
            children.forEach(child => {
                html += buildCommentHTML(child, true);
            });
        });
        html += '</div>';
        listEl.innerHTML = html;

        // ì´ë²¤íŠ¸ ë°”ì¸ë”©
        bindCommentEvents(listEl, postId);
    }

    function buildCommentHTML(c, isReply) {
        const initial = (c.author || '?')[0].toUpperCase();
        const replyClass = isReply ? ' is-reply' : '';
        const likesNum = c.likes || 0;
        const replyBtn = !isReply
            ? `<button class="comment-action-btn reply-toggle-btn" data-comment-id="${c.id}"><i class="fas fa-reply"></i> ë‹µê¸€</button>`
            : '';
        return `
        <div class="comment-item${replyClass}" data-cid="${c.id}">
            <div class="comment-header">
                <div class="comment-avatar">${escHtml(initial)}</div>
                <span class="comment-author-name">${escHtml(c.author || 'ìµëª…')}</span>
                <span class="comment-date">${fmtDate(c.created_at)}</span>
                <div class="comment-actions">
                    ${replyBtn}
                    <button class="comment-action-btn like-btn${likesNum > 0 ? ' like-active' : ''}" data-comment-id="${c.id}" data-likes="${likesNum}">
                        <i class="fas fa-thumbs-up"></i> ${likesNum > 0 ? likesNum : ''}
                    </button>
                    <button class="comment-action-btn delete-btn" data-comment-id="${c.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            <div class="comment-body">${escHtml(c.content || '')}</div>
            ${!isReply ? `
            <div class="reply-form-wrap" id="replyForm-${c.id}">
                <div class="reply-form">
                    <input type="text" class="reply-author-input" id="replyAuthor-${c.id}" placeholder="ë‹‰ë„¤ì„" maxlength="20" />
                    <textarea class="reply-textarea" id="replyText-${c.id}" placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." maxlength="300" rows="2"></textarea>
                    <div class="reply-btns">
                        <button class="reply-submit-btn" data-parent-id="${c.id}"><i class="fas fa-paper-plane"></i> ë“±ë¡</button>
                        <button class="reply-cancel-btn" data-target="replyForm-${c.id}">ì·¨ì†Œ</button>
                    </div>
                </div>
            </div>` : ''}
        </div>`;
    }

    // â”€â”€â”€ ì´ë²¤íŠ¸ ë°”ì¸ë”© â”€â”€â”€
    function bindCommentEvents(container, postId) {
        // ë‹µê¸€ í† ê¸€
        container.querySelectorAll('.reply-toggle-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const cid = btn.dataset.commentId;
                const formWrap = document.getElementById(`replyForm-${cid}`);
                if (!formWrap) return;
                const isOpen = formWrap.classList.contains('open');
                // ë‹¤ë¥¸ ë‹µê¸€ í¼ ëª¨ë‘ ë‹«ê¸°
                container.querySelectorAll('.reply-form-wrap.open').forEach(w => w.classList.remove('open'));
                if (!isOpen) {
                    formWrap.classList.add('open');
                    document.getElementById(`replyAuthor-${cid}`)?.focus();
                }
            });
        });

        // ë‹µê¸€ ì·¨ì†Œ
        container.querySelectorAll('.reply-cancel-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const targetId = btn.dataset.target;
                document.getElementById(targetId)?.classList.remove('open');
            });
        });

        // ë‹µê¸€ ë“±ë¡
        container.querySelectorAll('.reply-submit-btn').forEach(btn => {
            btn.addEventListener('click', () => submitReply(btn.dataset.parentId, postId));
        });

        // ë‹µê¸€ Ctrl+Enter
        container.querySelectorAll('.reply-textarea').forEach(ta => {
            ta.addEventListener('keydown', e => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    const parentId = ta.id.replace('replyText-', '');
                    submitReply(parentId, postId);
                }
            });
        });

        // ì¢‹ì•„ìš”
        container.querySelectorAll('.like-btn').forEach(btn => {
            btn.addEventListener('click', () => likeComment(btn, postId));
        });

        // ì‚­ì œ
        container.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', () => deleteComment(btn.dataset.commentId, postId));
        });
    }

    // â”€â”€â”€ ëŒ“ê¸€ ë“±ë¡ â”€â”€â”€
    async function submitComment() {
        const author  = document.getElementById('newCommentAuthor').value.trim();
        const content = document.getElementById('newCommentText').value.trim();

        if (!author) { showToast('âš ï¸ ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
        if (!content) { showToast('âš ï¸ ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
        if (!_currentPostId) return;

        const btn = document.getElementById('submitCommentBtn');
        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ë“±ë¡ ì¤‘...';

        try {
            await SupabaseDB.create('community_comments', {
                post_id: _currentPostId,
                parent_id: null,
                author,
                content,
                likes: 0,
                is_deleted: false
            });

            // ì…ë ¥ ì´ˆê¸°í™”
            document.getElementById('newCommentText').value = '';
            document.getElementById('newCommentCharCount').textContent = '0/500';

            showToast('âœ… ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            await loadComments(_currentPostId);

            // ê²Œì‹œê¸€ ì¹´ë“œì˜ ëŒ“ê¸€ ìˆ˜ë„ ê°±ì‹ 
            refreshCommentCount(_currentPostId);
        } catch {
            showToast('âŒ ëŒ“ê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        } finally {
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-paper-plane"></i> ëŒ“ê¸€ ë“±ë¡';
        }
    }

    // â”€â”€â”€ ëŒ€ëŒ“ê¸€ ë“±ë¡ â”€â”€â”€
    async function submitReply(parentId, postId) {
        const authorEl  = document.getElementById(`replyAuthor-${parentId}`);
        const contentEl = document.getElementById(`replyText-${parentId}`);
        const author  = authorEl?.value.trim();
        const content = contentEl?.value.trim();

        if (!author)  { showToast('âš ï¸ ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
        if (!content) { showToast('âš ï¸ ë‹µê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

        try {
            await SupabaseDB.create('community_comments', {
                post_id: postId,
                parent_id: parentId,
                author,
                content,
                likes: 0,
                is_deleted: false
            });

            showToast('âœ… ë‹µê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            await loadComments(postId);
            refreshCommentCount(postId);
        } catch {
            showToast('âŒ ë‹µê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // â”€â”€â”€ ëŒ“ê¸€ ì¢‹ì•„ìš” â”€â”€â”€
    async function likeComment(btn, postId) {
        const cid    = btn.dataset.commentId;
        const likes  = parseInt(btn.dataset.likes) || 0;
        const newVal = likes + 1;
        btn.disabled = true;

        try {
            await SupabaseDB.update('community_comments', cid, { likes: newVal });
            btn.dataset.likes = newVal;
            btn.classList.add('like-active');
            btn.innerHTML = `<i class="fas fa-thumbs-up"></i> ${newVal}`;
        } catch {
            showToast('âŒ ì¢‹ì•„ìš” ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        } finally {
            btn.disabled = false;
        }
    }

    // â”€â”€â”€ ëŒ“ê¸€ ì‚­ì œ â”€â”€â”€
    async function deleteComment(cid, postId) {
        if (!confirm('ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

        try {
            await SupabaseDB.update('community_comments', cid, { is_deleted: true, content: 'ì‚­ì œëœ ëŒ“ê¸€ì…ë‹ˆë‹¤.' });
            showToast('ğŸ—‘ï¸ ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            await loadComments(postId);
            refreshCommentCount(postId);
        } catch {
            showToast('âŒ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // â”€â”€â”€ ê²Œì‹œê¸€ ì¹´ë“œ ëŒ“ê¸€ ìˆ˜ ê°±ì‹  â”€â”€â”€
    function refreshCommentCount(postId) {
        const cached = _commentCache[postId];
        if (!cached) return;
        const cnt = cached.length;
        // ëª©ë¡ ì¹´ë“œì˜ ëŒ“ê¸€ ìˆ˜ ìŠ¤íŒ¬ ì—…ë°ì´íŠ¸
        const el = document.querySelector(`[data-post-id="${postId}"] .comment-cnt-val`);
        if (el) el.textContent = cnt;
    }
    </script>
    <script>
    // í–„ë²„ê±° ë©”ë‰´
    // Auth ì´ˆê¸°í™” (í˜ì´ì§€ ë¡œë“œ ì‹œ)
    initAuth();

    document.addEventListener('DOMContentLoaded', function() {
        const btn = document.getElementById('hamburgerBtn');
        const menu = document.getElementById('mobileMenu');
        if (btn && menu) {
            btn.addEventListener('click', function() {
                const isOpen = menu.classList.toggle('is-open');
                btn.classList.toggle('is-open', isOpen);
            });
            document.addEventListener('click', function(e) {
                if (!btn.contains(e.target) && !menu.contains(e.target)) {
                    menu.classList.remove('is-open');
                    btn.classList.remove('is-open');
                }
            });
        }
    });
    </script>
</body>
</html>
