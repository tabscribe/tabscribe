<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#e85d04">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<link rel="icon" href="images/og-thumbnail.png" type="image/png">
<link rel="apple-touch-icon" href="images/og-thumbnail.png">
<title>ì½”ë“œë•ì¿  ì•…ë³´ ê³µìœ </title>
<meta name="description" content="ê¸°íƒ€Â·ë² ì´ìŠ¤ ì½”ë“œ ì•…ë³´ë¥¼ PDFë¡œ ì—…ë¡œë“œí•˜ê³  ê³µìœ í•˜ì„¸ìš”. ì½”ë“œë•ì¿  ì•…ë³´ ê³µìœ  ì»¤ë®¤ë‹ˆí‹°.">
<!-- ê²€ìƒ‰ì—”ì§„ ìµœì í™” (SEO) -->
<meta name="robots" content="index, follow">
<meta name="author" content="COODUCK">
<meta name="keywords" content="ê¸°íƒ€ ì•…ë³´, ì½”ë“œ ì•…ë³´, íƒ€ë¸Œì•…ë³´, ì•…ë³´ ê³µìœ , PDF ì•…ë³´, ê¸°íƒ€ ì½”ë“œ, ë² ì´ìŠ¤ ì•…ë³´, ì½”ë“œë•ì¿ , Codeducku">
<link rel="canonical" href="https://codeducku.vercel.app/score.html">
<meta property="og:type" content="website">
<meta property="og:title" content="ì½”ë“œë•ì¿  ì•…ë³´ ê³µìœ ">
<meta property="og:description" content="ê¸°íƒ€Â·ë² ì´ìŠ¤ ì½”ë“œ ì•…ë³´ë¥¼ PDFë¡œ ì—…ë¡œë“œí•˜ê³  ê³µìœ í•˜ì„¸ìš”. ì½”ë“œë•ì¿  ì•…ë³´ ê³µìœ  ì»¤ë®¤ë‹ˆí‹°.">
<meta property="og:image" content="https://www.genspark.ai/api/files/s/EsaPAYLv">
<meta property="og:locale" content="ko_KR">
<meta property="og:site_name" content="ì½”ë“œë•ì¿  by COODUCK">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="ì½”ë“œë•ì¿  ì•…ë³´ ê³µìœ ">
<meta name="twitter:description" content="ê¸°íƒ€Â·ë² ì´ìŠ¤ ì½”ë“œ ì•…ë³´ë¥¼ ê³µìœ í•˜ì„¸ìš”.">
<meta name="twitter:image" content="https://www.genspark.ai/api/files/s/EsaPAYLv">
<!-- Google Search Console ì†Œìœ ê¶Œ ì¸ì¦ -->
<meta name="google-site-verification" content="y_LIOep_Kgw8SPVqt4XB5oCKlfscobw2V2fkQV2J6HM" />
<!-- Naver Search Advisor ì†Œìœ ê¶Œ ì¸ì¦ -->
<meta name="naver-site-verification" content="72f154aec62c295b28b8f27b077b8c961e862892" />
<link rel="stylesheet" href="css/style.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
<script src="js/ads.js"></script>
<style>
/* â”€â”€ ì•…ë³´ê³µìœ  ì „ìš© ìƒ‰ìƒ ë³€ìˆ˜ â”€â”€ */
:root {
  --score-primary:   #6d28d9;
  --score-light:     #f5f3ff;
  --score-border:    #ddd6fe;
  --score-hover:     #ede9fe;
  --score-dark:      #5b21b6;
}

/* â”€â”€ íˆì–´ë¡œ â”€â”€ */
.score-hero {
  background: linear-gradient(135deg, #f5f3ff 0%, #fafffe 50%, #eff6ff 100%);
  border-bottom: 1px solid var(--border-light);
  padding: 36px 0 28px;
}
.score-hero-inner {
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 20px;
  display: flex;
  align-items: center;
  gap: 18px;
}
.score-hero-icon {
  width: 60px; height: 60px;
  background: linear-gradient(135deg, #6d28d9, #7c3aed);
  border-radius: 18px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.8rem;
  box-shadow: 0 4px 16px rgba(109,40,217,0.25);
  flex-shrink: 0;
}
.score-hero h1 {
  font-size: 1.7rem;
  font-weight: 800;
  color: var(--text-primary);
  margin-bottom: 4px;
}
.score-hero p {
  font-size: 0.88rem;
  color: var(--text-secondary);
}
.score-stats {
  margin-left: auto;
  display: flex;
  gap: 20px;
  flex-shrink: 0;
}
.score-stat-item { text-align: center; }
.score-stat-item .num {
  font-size: 1.4rem;
  font-weight: 800;
  color: var(--score-primary);
}
.score-stat-item .lbl {
  font-size: 0.72rem;
  color: var(--text-muted);
}

/* â”€â”€ ë©”ì¸ 3ë‹¨ ë ˆì´ì•„ì›ƒ â”€â”€ */
.score-main-layout {
  max-width: 1560px;
  margin: 0 auto;
  padding: 28px 20px 80px;
  display: grid;
  grid-template-columns: 200px minmax(0,1fr) 200px;
  gap: 22px;
  align-items: start;
}
.score-center-wrapper {
  display: grid;
  grid-template-columns: 220px minmax(0,1fr);
  gap: 22px;
}
@media(max-width:1300px) {
  .score-main-layout { grid-template-columns: 170px minmax(0,1fr) 170px; gap:14px; }
}
@media(max-width:1000px) {
  .score-main-layout { grid-template-columns: 1fr; }
  .score-ad-side { display: none; }
  .score-center-wrapper { grid-template-columns: 1fr; }
  .score-sidebar { display: none; }
}

/* â”€â”€ ê´‘ê³  ì‚¬ì´ë“œ â”€â”€ */
.score-ad-side {
  position: sticky;
  top: 72px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* â”€â”€ ì‚¬ì´ë“œë°” â”€â”€ */
.score-sidebar {
  position: sticky;
  top: 20px;
  align-self: start;
}
.sidebar-section {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  margin-bottom: 14px;
  box-shadow: var(--shadow);
}
.sidebar-section h3 {
  font-size: 0.78rem;
  font-weight: 700;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 10px;
}
.sidebar-menu { list-style: none; }
.sidebar-menu li button {
  display: flex;
  align-items: center;
  gap: 9px;
  padding: 8px 10px;
  border-radius: 8px;
  font-size: 0.88rem;
  font-weight: 500;
  color: var(--text-secondary);
  cursor: pointer;
  background: none;
  border: none;
  width: 100%;
  text-align: left;
  transition: all 0.15s;
  font-family: 'Inter', sans-serif;
}
.sidebar-menu li button:hover {
  background: var(--score-light);
  color: var(--score-primary);
}
.sidebar-menu li button.active {
  background: var(--score-light);
  color: var(--score-primary);
  font-weight: 700;
}
.sidebar-menu li button .cnt {
  margin-left: auto;
  background: var(--score-light);
  color: var(--score-primary);
  font-size: 0.7rem;
  font-weight: 700;
  padding: 1px 7px;
  border-radius: 99px;
}

/* â”€â”€ ì½˜í…ì¸  ì˜ì—­ â”€â”€ */
.score-content {}

/* íƒ‘ í•„í„° ë°” */
.score-filter-bar {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 16px;
  flex-wrap: wrap;
}
.score-category-title {
  font-size: 1.15rem;
  font-weight: 800;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 8px;
}
.score-category-title .icon-badge {
  width: 32px; height: 32px;
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1rem;
}
.top-filter-group {
  margin-left: auto;
  display: flex;
  gap: 8px;
  align-items: center;
}
.score-sort-select {
  padding: 6px 12px;
  border: 1.5px solid var(--border);
  border-radius: 8px;
  font-size: 0.82rem;
  color: var(--text-secondary);
  background: var(--bg-card);
  cursor: pointer;
  outline: none;
  font-family: 'Inter', sans-serif;
}
.score-sort-select:focus { border-color: var(--score-primary); }
.score-write-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 7px 16px;
  background: var(--score-primary);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-size: 0.82rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  font-family: 'Inter', sans-serif;
}
.score-write-btn:hover { background: var(--score-dark); transform: translateY(-1px); }

/* ê²€ìƒ‰ ë°” */
.score-search-bar {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
}
.score-search-bar input {
  flex: 1;
  padding: 9px 14px;
  border: 1.5px solid var(--border);
  border-radius: 10px;
  font-size: 0.9rem;
  outline: none;
  color: var(--text-primary);
  background: var(--bg-card);
  font-family: 'Inter', sans-serif;
}
.score-search-bar input:focus { border-color: var(--score-primary); }
.score-search-bar button {
  padding: 9px 16px;
  background: var(--score-primary);
  color: #fff;
  border: none;
  border-radius: 10px;
  font-size: 0.88rem;
  font-weight: 600;
  cursor: pointer;
  font-family: 'Inter', sans-serif;
  transition: background 0.18s;
}
.score-search-bar button:hover { background: var(--score-dark); }

/* ì•ˆë‚´ ë°°ë„ˆ */
.score-tip-banner {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  background: var(--score-light);
  border: 1px solid var(--score-border);
  border-radius: 10px;
  padding: 12px 16px;
  margin-bottom: 18px;
  font-size: 0.85rem;
  color: var(--text-secondary);
}
.score-tip-banner .tip-icon { font-size: 1.1rem; flex-shrink: 0; }

/* ê²Œì‹œê¸€ ëª©ë¡ */
.score-post-list { display: flex; flex-direction: column; gap: 10px; }

.score-post-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px 20px;
  cursor: pointer;
  transition: all 0.18s;
  box-shadow: var(--shadow);
  display: flex;
  align-items: center;
  gap: 16px;
}
.score-post-card:hover {
  border-color: var(--score-border);
  box-shadow: 0 4px 20px rgba(109,40,217,0.10);
  transform: translateY(-1px);
}

.score-post-icon {
  width: 48px; height: 48px;
  background: var(--score-light);
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.4rem;
  flex-shrink: 0;
  border: 1.5px solid var(--score-border);
}

.score-post-main { flex: 1; min-width: 0; }
.score-post-top {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 5px;
  flex-wrap: wrap;
}
.score-post-title {
  font-size: 1rem;
  font-weight: 700;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 340px;
}
.score-post-artist {
  font-size: 0.82rem;
  color: var(--score-primary);
  font-weight: 600;
  white-space: nowrap;
}

/* íƒœê·¸ë“¤ */
.score-tag {
  display: inline-flex;
  align-items: center;
  gap: 3px;
  padding: 2px 8px;
  border-radius: 6px;
  font-size: 0.7rem;
  font-weight: 700;
  white-space: nowrap;
}
.score-tag--inst   { background: #eff6ff; border: 1px solid #bfdbfe; color: #1a56db; }
.score-tag--genre  { background: #f0fdf4; border: 1px solid #bbf7d0; color: #057a55; }
.score-tag--diff   { background: #fffbeb; border: 1px solid #fde68a; color: #b45309; }
.score-tag--tuning { background: #f0fdfa; border: 1px solid #99f6e4; color: #0f766e; }

.score-post-meta {
  display: flex;
  align-items: center;
  gap: 14px;
  font-size: 0.75rem;
  color: var(--text-muted);
  flex-wrap: wrap;
}
.score-post-meta span { display: flex; align-items: center; gap: 4px; }
.score-post-meta i { font-size: 0.7rem; }

.score-post-desc {
  font-size: 0.82rem;
  color: var(--text-secondary);
  margin-top: 4px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 560px;
}

.score-post-actions {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8px;
  flex-shrink: 0;
}
.score-action-btn {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 6px 12px;
  border-radius: 7px;
  font-size: 0.76rem;
  font-weight: 700;
  cursor: pointer;
  border: 1.5px solid transparent;
  transition: all 0.16s;
  font-family: 'Inter', sans-serif;
  white-space: nowrap;
}
.score-action-btn--dl {
  background: #eff6ff;
  border-color: #bfdbfe;
  color: #1a56db;
}
.score-action-btn--dl:hover { background: #dbeafe; }
.score-action-btn--like {
  background: #fff1f2;
  border-color: #fecdd3;
  color: #be123c;
}
.score-action-btn--like:hover { background: #ffe4e6; }
.score-action-btn--like.liked { background: #be123c; color: #fff; border-color: #be123c; }

/* í˜ì´ì§€ë„¤ì´ì…˜ */
.score-pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;
  margin-top: 24px;
}
.page-btn {
  width: 34px; height: 34px;
  border-radius: 8px;
  border: 1.5px solid var(--border);
  background: var(--bg-card);
  color: var(--text-secondary);
  font-size: 0.82rem;
  font-weight: 600;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.15s;
  font-family: 'Inter', sans-serif;
}
.page-btn:hover { border-color: var(--score-primary); color: var(--score-primary); }
.page-btn.active { background: var(--score-primary); border-color: var(--score-primary); color: #fff; }
.page-btn:disabled { opacity: 0.4; cursor: not-allowed; }

/* ë¹ˆ ìƒíƒœ */
.score-empty {
  text-align: center;
  padding: 64px 20px;
  color: var(--text-muted);
}
.score-empty i {
  font-size: 2.8rem;
  color: var(--score-primary);
  opacity: 0.3;
  display: block;
  margin-bottom: 14px;
}
.score-empty-title {
  font-size: 1rem;
  font-weight: 700;
  color: var(--text-secondary);
  margin-bottom: 6px;
}
.score-empty p { font-size: 0.88rem; }

/* ê²°ê³¼ ì¹´ìš´íŠ¸ */
.score-result-count {
  font-size: 0.82rem;
  color: var(--text-muted);
  margin-bottom: 12px;
}
.score-result-count strong { color: var(--score-primary); font-weight: 800; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ê¸€ì“°ê¸° ëª¨ë‹¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.52);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.22s;
}
.modal-overlay.open {
  opacity: 1;
  pointer-events: auto;
}
.score-modal {
  background: #fff;
  border-radius: 18px;
  width: 100%;
  max-width: 640px;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0,0,0,0.22);
  transform: translateY(20px);
  transition: transform 0.22s;
}
.modal-overlay.open .score-modal { transform: translateY(0); }

.score-modal-header {
  padding: 18px 22px 14px;
  border-bottom: 1.5px solid var(--border-light);
  display: flex;
  align-items: center;
  gap: 10px;
  flex-shrink: 0;
}
.score-modal-header i { color: var(--score-primary); font-size: 1.1rem; }
.score-modal-title {
  font-size: 1.05rem;
  font-weight: 800;
  color: var(--text-primary);
  flex: 1;
}
.modal-close-btn {
  width: 32px; height: 32px;
  border: none;
  background: var(--border-light);
  border-radius: 8px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.9rem;
  color: var(--text-muted);
  transition: all 0.15s;
}
.modal-close-btn:hover { background: #fee2e2; color: #dc2626; }

.score-modal-body {
  flex: 1;
  overflow-y: auto;
  padding: 20px 22px;
}

/* í¼ */
.upload-form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}
.form-group { display: flex; flex-direction: column; gap: 5px; }
.form-group.full { grid-column: 1 / -1; }
.form-label {
  font-size: 0.73rem;
  font-weight: 700;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}
.form-req { color: #dc2626; }
.form-input, .form-select, .form-textarea {
  background: #fff;
  border: 1.5px solid var(--border);
  border-radius: 8px;
  padding: 9px 13px;
  font-size: 0.87rem;
  color: var(--text-primary);
  font-family: 'Inter', sans-serif;
  transition: border-color 0.2s;
  width: 100%;
}
.form-input:focus, .form-select:focus, .form-textarea:focus {
  outline: none;
  border-color: var(--score-primary);
}
.form-textarea { resize: vertical; min-height: 72px; }
.form-select {
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%236b7280' stroke-width='1.8' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 32px;
}

/* ë“œë¡­ì¡´ */
.drop-zone {
  border: 2.5px dashed var(--score-border);
  border-radius: 12px;
  background: var(--score-light);
  padding: 28px 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}
.drop-zone:hover, .drop-zone.drag-over {
  border-color: var(--score-primary);
  background: #ede9fe;
}
.drop-zone-icon { font-size: 2rem; color: var(--score-primary); opacity: 0.55; margin-bottom: 8px; }
.drop-zone-text { font-size: 0.9rem; font-weight: 700; color: var(--text-secondary); margin-bottom: 3px; }
.drop-zone-sub  { font-size: 0.76rem; color: var(--text-muted); }
.drop-zone input[type="file"] {
  position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
}
.file-info {
  font-size: 0.78rem;
  color: var(--text-muted);
  display: flex;
  align-items: center;
  gap: 6px;
  margin-top: 8px;
}
.file-info i { color: var(--score-primary); }
.file-info.has-file { color: var(--score-primary); font-weight: 600; }

.score-modal-footer {
  padding: 14px 22px;
  border-top: 1.5px solid var(--border-light);
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  flex-shrink: 0;
}
.modal-cancel-btn {
  padding: 9px 20px;
  border-radius: 8px;
  border: 1.5px solid var(--border);
  background: #fff;
  color: var(--text-secondary);
  font-size: 0.87rem;
  font-weight: 600;
  cursor: pointer;
  font-family: 'Inter', sans-serif;
  transition: all 0.15s;
}
.modal-cancel-btn:hover { background: var(--border-light); }
.modal-submit-btn {
  padding: 9px 24px;
  border-radius: 8px;
  border: none;
  background: var(--score-primary);
  color: #fff;
  font-size: 0.87rem;
  font-weight: 700;
  cursor: pointer;
  font-family: 'Inter', sans-serif;
  transition: all 0.18s;
  display: flex;
  align-items: center;
  gap: 7px;
}
.modal-submit-btn:hover { background: var(--score-dark); transform: translateY(-1px); }
.modal-submit-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PDF ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pdf-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  z-index: 1100;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.22s;
}
.pdf-overlay.open { opacity: 1; pointer-events: auto; }
.pdf-modal {
  background: #fff;
  border-radius: 16px;
  width: 100%;
  max-width: 900px;
  max-height: 92vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0,0,0,0.28);
  transform: translateY(20px);
  transition: transform 0.22s;
}
.pdf-overlay.open .pdf-modal { transform: translateY(0); }
.pdf-modal-header {
  padding: 14px 20px;
  border-bottom: 1.5px solid var(--border-light);
  display: flex;
  align-items: center;
  gap: 10px;
  flex-shrink: 0;
}
.pdf-modal-title { font-size: 0.97rem; font-weight: 800; color: var(--text-primary); flex: 1; min-width: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.pdf-modal-body { flex: 1; overflow: hidden; background: #f3f4f6; }
.pdf-viewer { width: 100%; height: 100%; min-height: 520px; border: none; display: block; }
.pdf-modal-footer {
  padding: 10px 20px;
  border-top: 1.5px solid var(--border-light);
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  flex-shrink: 0;
}
.pdf-btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 8px 18px; border-radius: 8px;
  font-size: 0.84rem; font-weight: 700;
  cursor: pointer; border: none;
  font-family: 'Inter', sans-serif; transition: all 0.16s;
}
.pdf-btn--dl { background: linear-gradient(135deg,#7c3aed,#6d28d9); color: #fff; }
.pdf-btn--dl:hover { background: linear-gradient(135deg,#6d28d9,#5b21b6); }
.pdf-btn--close { background: var(--border-light); color: var(--text-secondary); }
.pdf-btn--close:hover { background: var(--border); }

/* â”€â”€ í† ìŠ¤íŠ¸ â”€â”€ */
.toast {
  position: fixed;
  bottom: 28px;
  right: 28px;
  background: #1e2433;
  color: #fff;
  padding: 12px 20px;
  border-radius: 10px;
  font-size: 0.84rem;
  font-weight: 600;
  z-index: 2000;
  transform: translateY(20px);
  opacity: 0;
  transition: all 0.25s;
  pointer-events: none;
  display: flex;
  align-items: center;
  gap: 8px;
  max-width: 320px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.22);
}
.toast.show { transform: translateY(0); opacity: 1; }
.toast-success i { color: #34d399; }
.toast-error i   { color: #f87171; }
.toast-info i    { color: #60a5fa; }

/* â”€â”€ í™ˆ FAB â”€â”€ */
.home-fab {
  position: fixed; bottom: 26px; left: 26px;
  width: 48px; height: 48px;
  background: var(--accent);
  color: #fff;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.2rem;
  text-decoration: none;
  box-shadow: 0 4px 16px rgba(232,93,4,0.38);
  z-index: 800;
  transition: background 0.18s, transform 0.18s;
}
.home-fab:hover { background: #c24e03; transform: scale(1.1); }
.home-fab-tooltip {
  position: absolute; left: 56px; top: 50%; transform: translateY(-50%);
  background: #1e2433; color: #fff; font-size: 0.74rem; font-weight: 700;
  padding: 4px 11px; border-radius: 8px; white-space: nowrap;
  opacity: 0; pointer-events: none; transition: opacity 0.18s;
}
.home-fab:hover .home-fab-tooltip { opacity: 1; }

/* â”€â”€ ë¡œë”© ìŠ¤í”¼ë„ˆ â”€â”€ */
.loading-spinner {
  text-align: center;
  padding: 48px 20px;
  color: var(--text-muted);
  font-size: 0.9rem;
}
.loading-spinner i { font-size: 2rem; color: var(--score-primary); display: block; margin-bottom: 12px; opacity: 0.5; }

/* â”€â”€ ë°˜ì‘í˜• â”€â”€ */
@media(max-width: 768px) {
  .score-hero { padding: 24px 0 18px; }
  .score-hero-inner { flex-wrap: wrap; gap: 12px; padding: 0 14px; }
  .score-hero h1 { font-size: clamp(1.1rem, 5vw, 1.4rem); word-break: keep-all; }
  .score-hero p  { font-size: 0.82rem; word-break: keep-all; }
  .score-stats { margin-left: 0; flex-wrap: wrap; gap: 12px; }
  .upload-form-grid { grid-template-columns: 1fr; }
  .score-post-card { flex-wrap: wrap; padding: 12px 14px; }
  .score-post-actions { flex-direction: row; width: 100%; }
  .score-post-title { max-width: 100%; white-space: normal; word-break: keep-all; font-size: 0.9rem; }
  .score-post-desc { max-width: 100%; font-size: 0.78rem; }
  .score-layout { grid-template-columns: 1fr; }
  .score-side { display: none; }
}
@media(max-width: 520px) {
  .score-stats { gap: 10px; }
}
</style>
</head>
<body>

<!-- â”€â”€ í—¤ë” â”€â”€ -->
<header class="header">
  <div class="header-inner">
    <a href="index.html" class="logo" aria-label="ì½”ë“œë•ì¿  í™ˆìœ¼ë¡œ ì´ë™">
      <i class="fas fa-guitar"></i>
      <div class="logo-textbox">
          <span class="logo-text">Code<span class="accent">ducku</span></span>
          <span class="logo-ko">ì½”ë“œë•ì¿ </span>
      </div>
    </a>
        <nav class="header-nav" id="headerNav">
      <a href="index.html" class="nav-btn nav-btn--accent"><i class="fas fa-home"></i> í™ˆ</a>
      <a href="rehearsal.html" class="nav-btn nav-btn--blue"><i class="fas fa-music"></i> í•©ì£¼ì‹¤</a>
      <a href="repair.html" class="nav-btn nav-btn--purple"><i class="fas fa-tools"></i> ë¦¬í˜ì–´ìƒµ</a>
      <a href="instrument.html" class="nav-btn nav-btn--teal"><i class="fas fa-guitar"></i> ì•…ê¸°ìƒµ</a>
      <a href="score.html" class="nav-btn nav-btn--violet"><i class="fas fa-file-pdf"></i> ì•…ë³´ê³µìœ </a>
      <a href="community.html" class="nav-btn nav-btn--orange"><i class="fas fa-users"></i> ì»¤ë®¤ë‹ˆí‹°</a>
    </nav>
    <div class="header-auth-btns">
        <a href="login.html" class="nav-btn nav-btn--login" id="headerLoginBtn"><i class="fas fa-sign-in-alt"></i> ë¡œê·¸ì¸</a>
        <a href="profile.html" class="header-profile-btn" id="headerProfileBtn" style="display:none"><i class="fas fa-user-circle"></i><span id="headerNickname"></span></a>
        <button class="nav-btn nav-btn--logout" id="headerLogoutBtn" style="display:none" onclick="authLogout()"><i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ</button>
    </div>
    <button class="hamburger-btn" id="hamburgerBtn" aria-label="ë©”ë‰´ ì—´ê¸°">
      <span></span><span></span><span></span>
    </button>
  </div>
  <div class="mobile-menu" id="mobileMenu">
    <a href="index.html" class="mobile-menu-item"><i class="fas fa-home"></i> í™ˆ</a>
    <a href="rehearsal.html" class="mobile-menu-item"><i class="fas fa-music"></i> í•©ì£¼ì‹¤</a>
    <a href="repair.html" class="mobile-menu-item"><i class="fas fa-tools"></i> ë¦¬í˜ì–´ìƒµ</a>
    <a href="instrument.html" class="mobile-menu-item"><i class="fas fa-guitar"></i> ì•…ê¸°ìƒµ</a>
    <a href="score.html" class="mobile-menu-item"><i class="fas fa-file-pdf"></i> ì•…ë³´ê³µìœ </a>
    <a href="community.html" class="mobile-menu-item"><i class="fas fa-users"></i> ì»¤ë®¤ë‹ˆí‹°</a>
    <div style="border-top:1px solid #e5e7eb;margin-top:4px;padding-top:4px">
        <a href="login.html" class="mobile-menu-item" id="mobileLoginBtn"><i class="fas fa-sign-in-alt"></i> ë¡œê·¸ì¸ / íšŒì›ê°€ì…</a>
        <button class="mobile-menu-item" id="mobileLogoutBtn" style="display:none;background:none;border:none;width:100%;text-align:left;cursor:pointer;font-family:inherit;" onclick="authLogout()"><i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </div>
</header>

<!-- â”€â”€ íˆì–´ë¡œ â”€â”€ -->
<div class="score-hero">
  <div class="score-hero-inner">
    <div class="score-hero-icon">ğŸµ</div>
    <div>
      <h1>ì½”ë“œ ì•…ë³´ ê³µìœ </h1>
      <p>ê¸°íƒ€Â·ë² ì´ìŠ¤ ì½”ë“œ ì•…ë³´ë¥¼ PDFë¡œ ì—…ë¡œë“œí•˜ê³  ê³µìœ í•˜ì„¸ìš” Â· ë¬´ë£Œ ë‹¤ìš´ë¡œë“œ</p>
    </div>
    <div class="score-stats">
      <div class="score-stat-item">
        <div class="num" id="statTotal">-</div>
        <div class="lbl">ë“±ë¡ ì•…ë³´</div>
      </div>
      <div class="score-stat-item">
        <div class="num" id="statDownloads">-</div>
        <div class="lbl">ì´ ë‹¤ìš´ë¡œë“œ</div>
      </div>
      <div class="score-stat-item">
        <div class="num">ğŸŸ¢</div>
        <div class="lbl">ë¬´ë£Œ ê³µìœ </div>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ 3ë‹¨ ë ˆì´ì•„ì›ƒ â”€â”€ -->
<div class="score-main-layout">

  <!-- ì¢Œì¸¡ ê´‘ê³  -->
  <div class="score-ad-side" id="scoreAdLeft"></div>

  <!-- ì‚¬ì´ë“œë°” + ì½˜í…ì¸  -->
  <div class="score-center-wrapper">

    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="score-sidebar">
      <div class="sidebar-section">
        <h3>ì•…ê¸°ë³„ ë¶„ë¥˜</h3>
        <ul class="sidebar-menu" id="instMenu">
          <li><button data-inst="" class="active"><i class="fas fa-th" style="width:16px;color:#6d28d9"></i> ì „ì²´ ì•…ë³´</button></li>
          <li><button data-inst="ê¸°íƒ€"><i class="fas fa-guitar" style="width:16px;color:#e85d04"></i> í†µê¸°íƒ€</button></li>
          <li><button data-inst="ì¼ë ‰ê¸°íƒ€"><i class="fas fa-bolt" style="width:16px;color:#2563eb"></i> ì¼ë ‰ê¸°íƒ€</button></li>
          <li><button data-inst="ë² ì´ìŠ¤"><i class="fas fa-music" style="width:16px;color:#16a34a"></i> ë² ì´ìŠ¤</button></li>
          <li><button data-inst="ìš°ì¿¨ë ë ˆ"><i class="fas fa-guitar" style="width:16px;color:#ea580c"></i> ìš°ì¿¨ë ë ˆ</button></li>
          <li><button data-inst="ê¸°íƒ€ ì „ì²´"><i class="fas fa-file-alt" style="width:16px;color:#7c3aed"></i> ì „ì²´ íƒ­+ì•…ë³´</button></li>
        </ul>
      </div>
      <div class="sidebar-section">
        <h3>ë‚œì´ë„ë³„</h3>
        <ul class="sidebar-menu" id="diffMenu">
          <li><button data-diff="" class="active"><i class="fas fa-layer-group" style="width:16px;color:#6d28d9"></i> ì „ì²´ ë‚œì´ë„</button></li>
          <li><button data-diff="ì…ë¬¸"><i class="fas fa-star" style="width:16px;color:#16a34a"></i> â­ ì…ë¬¸</button></li>
          <li><button data-diff="ì´ˆê¸‰"><i class="fas fa-star" style="width:16px;color:#2563eb"></i> â­â­ ì´ˆê¸‰</button></li>
          <li><button data-diff="ì¤‘ê¸‰"><i class="fas fa-star" style="width:16px;color:#ca8a04"></i> â­â­â­ ì¤‘ê¸‰</button></li>
          <li><button data-diff="ê³ ê¸‰"><i class="fas fa-star" style="width:16px;color:#ea580c"></i> â­â­â­â­ ê³ ê¸‰</button></li>
          <li><button data-diff="ì „ë¬¸ê°€"><i class="fas fa-star" style="width:16px;color:#dc2626"></i> â­â­â­â­â­ ì „ë¬¸ê°€</button></li>
        </ul>
      </div>
      <div class="sidebar-section">
        <h3>ì¥ë¥´ë³„</h3>
        <ul class="sidebar-menu" id="genreMenu">
          <li><button data-genre="" class="active"><i class="fas fa-music" style="width:16px;color:#6d28d9"></i> ì „ì²´ ì¥ë¥´</button></li>
          <li><button data-genre="íŒ"><i class="fas fa-compact-disc" style="width:16px;color:#db2777"></i> íŒ</button></li>
          <li><button data-genre="ë¡"><i class="fas fa-fire" style="width:16px;color:#dc2626"></i> ë¡ / ë©”íƒˆ</button></li>
          <li><button data-genre="ë°œë¼ë“œ"><i class="fas fa-heart" style="width:16px;color:#9333ea"></i> ë°œë¼ë“œ</button></li>
          <li><button data-genre="ì¬ì¦ˆ"><i class="fas fa-saxophone" style="width:16px;color:#ca8a04"></i> ì¬ì¦ˆ</button></li>
          <li><button data-genre="ë¸”ë£¨ìŠ¤"><i class="fas fa-headphones" style="width:16px;color:#0369a1"></i> ë¸”ë£¨ìŠ¤</button></li>
          <li><button data-genre="í´ë˜ì‹"><i class="fas fa-music" style="width:16px;color:#16a34a"></i> í´ë˜ì‹</button></li>
          <li><button data-genre="ê¸°íƒ€"><i class="fas fa-ellipsis-h" style="width:16px;color:#6b7280"></i> ê¸°íƒ€</button></li>
        </ul>
      </div>
    </aside>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="score-content">

      <!-- ì•ˆë‚´ ë°°ë„ˆ -->
      <div class="score-tip-banner">
        <span class="tip-icon">ğŸ’¡</span>
        <div>
          <strong>ì½”ë“œ ì•…ë³´ ê³µìœ  ì»¤ë®¤ë‹ˆí‹° ì˜¤í”ˆ!</strong>&nbsp;
          PDF í˜•ì‹ì˜ ê¸°íƒ€Â·ë² ì´ìŠ¤ ì½”ë“œ ì•…ë³´ë¥¼ ììœ ë¡­ê²Œ ì˜¬ë¦¬ê³  ë‚˜ëˆ ë³´ì„¸ìš”. ëª¨ë“  ì•…ë³´ëŠ” ë¬´ë£Œë¡œ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ ğŸ¸
        </div>
      </div>

      <!-- í•„í„° ë°” -->
      <div class="score-filter-bar">
        <div class="score-category-title">
          <span class="icon-badge" style="background:#f5f3ff;">ğŸ“„</span>
          <span id="currentCategoryTitle">ì „ì²´ ì•…ë³´</span>
        </div>
        <div class="top-filter-group">
          <select class="score-sort-select" id="sortSelect">
            <option value="latest">ìµœì‹ ìˆœ</option>
            <option value="downloads">ë‹¤ìš´ë¡œë“œìˆœ</option>
            <option value="likes">ì¢‹ì•„ìš”ìˆœ</option>
          </select>
          <button class="score-write-btn" id="writeBtn">
            <i class="fas fa-pen"></i> ì•…ë³´ ë“±ë¡
          </button>
        </div>
      </div>

      <!-- ê²€ìƒ‰ ë°” -->
      <div class="score-search-bar">
        <input type="text" id="searchInput" placeholder="ê³¡ëª…, ì•„í‹°ìŠ¤íŠ¸ ê²€ìƒ‰â€¦">
        <button onclick="doSearch()"><i class="fas fa-search"></i> ê²€ìƒ‰</button>
      </div>

      <!-- ê²°ê³¼ -->
      <div class="score-result-count" id="resultCount"></div>
      <div id="scoreList">
        <div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i>ì•…ë³´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
      </div>

      <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
      <div class="score-pagination" id="pagination"></div>

    </main>
  </div><!-- /score-center-wrapper -->

  <!-- ìš°ì¸¡ ê´‘ê³  -->
  <div class="score-ad-side" id="scoreAdRight"></div>

</div><!-- /score-main-layout -->


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ì•…ë³´ ë“±ë¡ ëª¨ë‹¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="writeModal">
  <div class="score-modal">
    <div class="score-modal-header">
      <i class="fas fa-file-pdf"></i>
      <div class="score-modal-title">ì•…ë³´ ë“±ë¡í•˜ê¸°</div>
      <button class="modal-close-btn" id="closeWriteModal"><i class="fas fa-times"></i></button>
    </div>
    <div class="score-modal-body">

      <!-- ë“œë¡­ì¡´ -->
      <div class="drop-zone" id="dropZone" style="margin-bottom:16px;">
        <div class="drop-zone-icon"><i class="fas fa-file-pdf"></i></div>
        <div class="drop-zone-text">PDF íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•´ì„œ ì„ íƒ</div>
        <div class="drop-zone-sub">PDF í˜•ì‹ë§Œ ì§€ì› Â· ìµœëŒ€ 10MB</div>
        <input type="file" id="fileInput" accept=".pdf">
      </div>
      <div class="file-info" id="fileInfo"><i class="fas fa-paperclip"></i> íŒŒì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</div>

      <div class="upload-form-grid" style="margin-top:16px;">
        <div class="form-group">
          <label class="form-label">ê³¡ ì œëª© <span class="form-req">*</span></label>
          <input class="form-input" id="titleInput" type="text" placeholder="ì˜ˆ) Hotel California" maxlength="80">
        </div>
        <div class="form-group">
          <label class="form-label">ì•„í‹°ìŠ¤íŠ¸ / ë°´ë“œ <span class="form-req">*</span></label>
          <input class="form-input" id="artistInput" type="text" placeholder="ì˜ˆ) Eagles" maxlength="60">
        </div>
        <div class="form-group">
          <label class="form-label">ì•…ê¸°</label>
          <select class="form-select" id="instrumentSelect">
            <option value="ê¸°íƒ€">ğŸ¸ ê¸°íƒ€ (í†µê¸°íƒ€)</option>
            <option value="ì¼ë ‰ê¸°íƒ€">âš¡ ì¼ë ‰ê¸°íƒ€</option>
            <option value="ë² ì´ìŠ¤">ğŸµ ë² ì´ìŠ¤</option>
            <option value="ìš°ì¿¨ë ë ˆ">ğŸ¶ ìš°ì¿¨ë ë ˆ</option>
            <option value="ê¸°íƒ€ ì „ì²´">ğŸ¼ ê¸°íƒ€ ì „ì²´ (íƒ­+ì•…ë³´)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">ì¥ë¥´</label>
          <select class="form-select" id="genreSelect">
            <option value="íŒ">íŒ</option>
            <option value="ë¡">ë¡</option>
            <option value="ë°œë¼ë“œ">ë°œë¼ë“œ</option>
            <option value="ì¬ì¦ˆ">ì¬ì¦ˆ</option>
            <option value="í´ë˜ì‹">í´ë˜ì‹</option>
            <option value="ë¸”ë£¨ìŠ¤">ë¸”ë£¨ìŠ¤</option>
            <option value="ì»¨íŠ¸ë¦¬">ì»¨íŠ¸ë¦¬</option>
            <option value="ë©”íƒˆ">ë©”íƒˆ</option>
            <option value="R&B">R&B / ì†Œìš¸</option>
            <option value="ê¸°íƒ€">ê¸°íƒ€</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">ë‚œì´ë„</label>
          <select class="form-select" id="diffSelect">
            <option value="ì…ë¬¸">â­ ì…ë¬¸</option>
            <option value="ì´ˆê¸‰">â­â­ ì´ˆê¸‰</option>
            <option value="ì¤‘ê¸‰" selected>â­â­â­ ì¤‘ê¸‰</option>
            <option value="ê³ ê¸‰">â­â­â­â­ ê³ ê¸‰</option>
            <option value="ì „ë¬¸ê°€">â­â­â­â­â­ ì „ë¬¸ê°€</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">íŠœë‹</label>
          <input class="form-input" id="tuningInput" type="text" placeholder="ì˜ˆ) Standard E / Drop D" maxlength="30">
        </div>
        <div class="form-group">
          <label class="form-label">ì¡°ì„± (Key)</label>
          <input class="form-input" id="keyInput" type="text" placeholder="ì˜ˆ) Am / C Major" maxlength="20">
        </div>
        <div class="form-group">
          <label class="form-label">ë‹‰ë„¤ì„</label>
          <input class="form-input" id="uploaderInput" type="text" placeholder="ë‹‰ë„¤ì„ (ì„ íƒ)" maxlength="30">
        </div>
        <div class="form-group full">
          <label class="form-label">ì„¤ëª… (ì„ íƒ)</label>
          <textarea class="form-textarea" id="descInput" placeholder="ì•…ë³´ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…, ì—°ì£¼ íŒ ë“±ì„ ì…ë ¥í•˜ì„¸ìš”." maxlength="300"></textarea>
        </div>
      </div>
    </div>
    <div class="score-modal-footer">
      <button class="modal-cancel-btn" id="cancelWriteModal">ì·¨ì†Œ</button>
      <button class="modal-submit-btn" id="submitBtn" disabled>
        <i class="fas fa-upload"></i> ë“±ë¡í•˜ê¸°
      </button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PDF ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="pdf-overlay" id="pdfOverlay">
  <div class="pdf-modal">
    <div class="pdf-modal-header">
      <i class="fas fa-file-pdf" style="color:#6d28d9;font-size:1rem;flex-shrink:0;"></i>
      <div class="pdf-modal-title" id="pdfModalTitle">ì•…ë³´ ë¯¸ë¦¬ë³´ê¸°</div>
      <button class="modal-close-btn" id="closePdfModal"><i class="fas fa-times"></i></button>
    </div>
    <div class="pdf-modal-body">
      <iframe class="pdf-viewer" id="pdfViewer" title="PDF ë¯¸ë¦¬ë³´ê¸°"></iframe>
    </div>
    <div class="pdf-modal-footer">
      <button class="pdf-btn pdf-btn--close" id="pdfCloseBtn">ë‹«ê¸°</button>
      <a class="pdf-btn pdf-btn--dl" id="pdfDownloadBtn" href="#" download><i class="fas fa-download"></i> ë‹¤ìš´ë¡œë“œ</a>
    </div>
  </div>
</div>

<!-- â”€â”€ í† ìŠ¤íŠ¸ â”€â”€ -->
<div class="toast" id="toast"><i class="fas fa-check-circle"></i><span id="toastMsg"></span></div>

<!-- â”€â”€ í™ˆ FAB â”€â”€ -->
<a href="index.html" class="home-fab">
  <i class="fas fa-home"></i>
  <span class="home-fab-tooltip">í™ˆìœ¼ë¡œ</span>
</a>

<script src="js/supabase.js"></script>
<script>
/* ============================================================
   ì•…ë³´ ê³µìœ  í˜ì´ì§€ â€” ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ v2.0 (Supabase ì—°ë™)
   ì €ì¥ì†Œ: Supabase (scores í…Œì´ë¸”)
   PDFëŠ” Base64ë¡œ file_data í•„ë“œì— ì €ì¥
============================================================ */

const API = 'scores'; // Supabase í…Œì´ë¸”ëª…
const PAGE_SIZE = 15;

/* â”€â”€ ìƒíƒœ â”€â”€ */
let currentPage   = 1;
let totalPages    = 1;
let currentInst   = '';
let currentDiff   = '';
let currentGenre  = '';
let currentSort   = 'latest';
let currentSearch = '';
let likedSet = new Set(JSON.parse(localStorage.getItem('TS_liked_scores') || '[]'));

/* â”€â”€ ìœ í‹¸ â”€â”€ */
function esc(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function fmtDate(ms){
  const d = new Date(ms);
  return `${d.getFullYear()}.${String(d.getMonth()+1).padStart(2,'0')}.${String(d.getDate()).padStart(2,'0')}`;
}
function diffStars(d){
  return {ì…ë¬¸:'â­',ì´ˆê¸‰:'â­â­',ì¤‘ê¸‰:'â­â­â­',ê³ ê¸‰:'â­â­â­â­',ì „ë¬¸ê°€:'â­â­â­â­â­'}[d]||d;
}
function instIcon(i){
  const m = {ê¸°íƒ€:'fa-guitar',ì¼ë ‰ê¸°íƒ€:'fa-bolt',ë² ì´ìŠ¤:'fa-music',ìš°ì¿¨ë ë ˆ:'fa-guitar','ê¸°íƒ€ ì „ì²´':'fa-file-alt'};
  return m[i]||'fa-file-pdf';
}
function saveLiked(){ localStorage.setItem('TS_liked_scores', JSON.stringify([...likedSet])); }

function showToast(msg, type='success'){
  const t = document.getElementById('toast');
  const i = t.querySelector('i');
  i.className = type==='success' ? 'fas fa-check-circle' : type==='error' ? 'fas fa-exclamation-circle' : 'fas fa-info-circle';
  t.className = `toast toast-${type}`;
  document.getElementById('toastMsg').textContent = msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 2800);
}

/* â”€â”€ Supabase API í—¬í¼ â”€â”€ */
async function apiGet(options={}){
  return await SupabaseDB.list('scores', {
    limit:  options.limit  || PAGE_SIZE,
    page:   options.page   || 1,
    search: options.search || '',
    searchFields: ['title','artist','uploader'],
    sort:   (options.sort||'-created_at').replace(/^-/,''),
    order:  (options.sort||'').startsWith('-') ? 'desc' : 'asc',
  });
}
async function apiPost(data){
  return await SupabaseDB.create('scores', data);
}
async function apiPatch(id, data){
  return await SupabaseDB.update('scores', id, data);
}

/* â”€â”€ ëª©ë¡ ë¡œë“œ â”€â”€ */
async function loadScores(){
  document.getElementById('scoreList').innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>';
  document.getElementById('pagination').innerHTML = '';

  try {
    const params = { page: currentPage, limit: PAGE_SIZE };
    if(currentSearch) params.search = currentSearch;

    // ì •ë ¬
    if(currentSort === 'downloads') params.sort = '-downloads';
    else if(currentSort === 'likes') params.sort = '-likes';
    else params.sort = '-created_at';

    const data = await apiGet(params);
    let rows = data.data || [];

    // í´ë¼ì´ì–¸íŠ¸ í•„í„° (ì•…ê¸°/ë‚œì´ë„/ì¥ë¥´)
    if(currentInst)  rows = rows.filter(r => r.instrument === currentInst);
    if(currentDiff)  rows = rows.filter(r => r.difficulty === currentDiff);
    if(currentGenre) rows = rows.filter(r => r.genre === currentGenre || (currentGenre==='ë¡' && r.genre==='ë©”íƒˆ'));

    totalPages = Math.max(1, Math.ceil((currentInst||currentDiff||currentGenre ? rows.length : (data.total||0)) / PAGE_SIZE));

    renderStats();
    renderList(rows);
    renderPagination();
    document.getElementById('resultCount').innerHTML = `<strong>${rows.length}</strong>ê°œ ì•…ë³´`;

  } catch(e){
    document.getElementById('scoreList').innerHTML = '<div class="loading-spinner"><i class="fas fa-exclamation-circle"></i>ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨. ìƒˆë¡œê³ ì¹¨í•´ ì£¼ì„¸ìš”.</div>';
  }
}

/* â”€â”€ í†µê³„ â”€â”€ */
async function renderStats(){
  try{
    const allStat = await SupabaseDB.list('scores', {limit:1});
    document.getElementById('statTotal').textContent = allStat.total ?? '-';
    const allData = await SupabaseDB.list('scores', {limit:500});
    const dl = (allData.data||[]).reduce((s,r)=>s+(r.downloads||0),0);
    document.getElementById('statDownloads').textContent = dl;
  } catch{}
}

/* â”€â”€ ëª©ë¡ ë Œë” â”€â”€ */
function renderList(rows){
  const el = document.getElementById('scoreList');
  if(!rows.length){
    el.innerHTML = `
      <div class="score-empty">
        <i class="fas fa-music"></i>
        <div class="score-empty-title">ë“±ë¡ëœ ì•…ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</div>
        <p>ì²« ë²ˆì§¸ ì•…ë³´ë¥¼ ë“±ë¡í•´ ë³´ì„¸ìš”!</p>
      </div>`;
    return;
  }
  el.innerHTML = `<div class="score-post-list">${rows.map(r=>cardHTML(r)).join('')}</div>`;
}

function cardHTML(r){
  const liked = likedSet.has(r.id);
  return `
  <div class="score-post-card" onclick="openDetail('${r.id}',event)">
    <div class="score-post-icon"><i class="fas ${instIcon(r.instrument)}"></i></div>
    <div class="score-post-main">
      <div class="score-post-top">
        <span class="score-post-title">${esc(r.title)}</span>
        <span class="score-post-artist"><i class="fas fa-user-music"></i> ${esc(r.artist)}</span>
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:5px;margin-bottom:5px;">
        <span class="score-tag score-tag--inst"><i class="fas fa-guitar"></i>${esc(r.instrument)}</span>
        <span class="score-tag score-tag--genre">${esc(r.genre)}</span>
        <span class="score-tag score-tag--diff">${diffStars(r.difficulty)} ${esc(r.difficulty)}</span>
        ${r.tuning ? `<span class="score-tag score-tag--tuning"><i class="fas fa-sliders-h"></i>${esc(r.tuning)}</span>` : ''}
      </div>
      ${r.desc ? `<div class="score-post-desc">${esc(r.desc)}</div>` : ''}
      <div class="score-post-meta">
        <span><i class="fas fa-user"></i>${esc(r.uploader||'ìµëª…')}</span>
        <span><i class="fas fa-calendar"></i>${fmtDate(r.created_at)}</span>
        <span><i class="fas fa-download"></i>${r.downloads||0}</span>
        <span><i class="fas fa-heart"></i>${r.likes||0}</span>
      </div>
    </div>
    <div class="score-post-actions" onclick="event.stopPropagation()">
      <button class="score-action-btn score-action-btn--dl" onclick="downloadScore('${r.id}')"><i class="fas fa-download"></i> ë‹¤ìš´ë¡œë“œ</button>
      <button class="score-action-btn score-action-btn--like ${liked?'liked':''}" id="likeBtn_${r.id}" onclick="toggleLike('${r.id}')"><i class="fas fa-heart"></i> ${r.likes||0}</button>
    </div>
  </div>`;
}

/* â”€â”€ í˜ì´ì§€ë„¤ì´ì…˜ â”€â”€ */
function renderPagination(){
  const el = document.getElementById('pagination');
  if(totalPages<=1){ el.innerHTML=''; return; }
  let html = `<button class="page-btn" onclick="goPage(${currentPage-1})" ${currentPage<=1?'disabled':''}><i class="fas fa-chevron-left"></i></button>`;
  const start = Math.max(1, currentPage-2);
  const end   = Math.min(totalPages, currentPage+2);
  if(start>1) html += `<button class="page-btn" onclick="goPage(1)">1</button>${start>2?'<span style="color:var(--text-muted);padding:0 4px;">â€¦</span>':''}`;
  for(let i=start;i<=end;i++){
    html += `<button class="page-btn ${i===currentPage?'active':''}" onclick="goPage(${i})">${i}</button>`;
  }
  if(end<totalPages) html += `${end<totalPages-1?'<span style="color:var(--text-muted);padding:0 4px;">â€¦</span>':''}<button class="page-btn" onclick="goPage(${totalPages})">${totalPages}</button>`;
  html += `<button class="page-btn" onclick="goPage(${currentPage+1})" ${currentPage>=totalPages?'disabled':''}><i class="fas fa-chevron-right"></i></button>`;
  el.innerHTML = html;
}
function goPage(p){ currentPage = p; loadScores(); window.scrollTo({top:0,behavior:'smooth'}); }

/* â”€â”€ ìƒì„¸(ë¯¸ë¦¬ë³´ê¸°) â”€â”€ */
async function openDetail(id, e){
  if(e && e.target.closest('.score-post-actions')) return;
  try{
    const r = await SupabaseDB.get('scores', id);
    if(!r.file_data){ showToast('PDF ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.','error'); return; }
    document.getElementById('pdfModalTitle').textContent = `${r.title} â€” ${r.artist}`;
    document.getElementById('pdfViewer').src = r.file_data;
    document.getElementById('pdfDownloadBtn').href = r.file_data;
    document.getElementById('pdfDownloadBtn').download = r.file_name || `${r.title}.pdf`;
    document.getElementById('pdfOverlay').classList.add('open');
    // ì¡°íšŒìˆ˜ ì¦ê°€
    apiPatch(id, {views:(r.views||0)+1}).catch(()=>{});
  } catch(err){ showToast('ì•…ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.','error'); }
}

/* â”€â”€ ë‹¤ìš´ë¡œë“œ â”€â”€ */
async function downloadScore(id){
  try{
    const r = await SupabaseDB.get('scores', id);
    if(!r.file_data){ showToast('PDF ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.','error'); return; }
    const a = document.createElement('a');
    a.href = r.file_data;
    a.download = r.file_name || `${r.title}.pdf`;
    a.click();
    await apiPatch(id, {downloads:(r.downloads||0)+1});
    showToast('ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.','info');
    loadScores();
  } catch(e){ showToast('ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.','error'); }
}

/* â”€â”€ ì¢‹ì•„ìš” â”€â”€ */
async function toggleLike(id){
  try{
    const r = await SupabaseDB.get('scores', id);
    const btn = document.getElementById(`likeBtn_${id}`);
    if(likedSet.has(id)){
      likedSet.delete(id);
      const newLikes = Math.max(0,(r.likes||0)-1);
      await apiPatch(id, {likes:newLikes});
      if(btn){ btn.classList.remove('liked'); btn.innerHTML=`<i class="fas fa-heart"></i> ${newLikes}`; }
    } else {
      likedSet.add(id);
      const newLikes = (r.likes||0)+1;
      await apiPatch(id, {likes:newLikes});
      if(btn){ btn.classList.add('liked'); btn.innerHTML=`<i class="fas fa-heart"></i> ${newLikes}`; }
      showToast('ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ìŠµë‹ˆë‹¤! â¤ï¸','success');
    }
    saveLiked();
  } catch(e){ showToast('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.','error'); }
}

/* â”€â”€ ì‚¬ì´ë“œë°” í•„í„° â”€â”€ */
function bindSidebar(){
  document.getElementById('instMenu').querySelectorAll('button').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.getElementById('instMenu').querySelectorAll('button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      currentInst = btn.dataset.inst;
      currentPage = 1;
      updateCategoryTitle();
      loadScores();
    });
  });
  document.getElementById('diffMenu').querySelectorAll('button').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.getElementById('diffMenu').querySelectorAll('button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      currentDiff = btn.dataset.diff;
      currentPage = 1;
      loadScores();
    });
  });
  document.getElementById('genreMenu').querySelectorAll('button').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.getElementById('genreMenu').querySelectorAll('button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      currentGenre = btn.dataset.genre;
      currentPage = 1;
      loadScores();
    });
  });
}

function updateCategoryTitle(){
  const map = {'':'ì „ì²´ ì•…ë³´','ê¸°íƒ€':'í†µê¸°íƒ€','ì¼ë ‰ê¸°íƒ€':'ì¼ë ‰ê¸°íƒ€','ë² ì´ìŠ¤':'ë² ì´ìŠ¤','ìš°ì¿¨ë ë ˆ':'ìš°ì¿¨ë ë ˆ','ê¸°íƒ€ ì „ì²´':'ì „ì²´ íƒ­+ì•…ë³´'};
  document.getElementById('currentCategoryTitle').textContent = map[currentInst]||currentInst;
}

/* â”€â”€ ê²€ìƒ‰ â”€â”€ */
function doSearch(){
  currentSearch = document.getElementById('searchInput').value.trim();
  currentPage   = 1;
  loadScores();
}
document.getElementById('searchInput').addEventListener('keydown', e=>{ if(e.key==='Enter') doSearch(); });
document.getElementById('sortSelect').addEventListener('change', e=>{ currentSort=e.target.value; currentPage=1; loadScores(); });

/* â”€â”€ ê¸€ì“°ê¸° ëª¨ë‹¬ â”€â”€ */
let selectedFile = null;

document.getElementById('writeBtn').addEventListener('click', ()=>{
  document.getElementById('writeModal').classList.add('open');
});
document.getElementById('closeWriteModal').addEventListener('click', closeWriteModal);
document.getElementById('cancelWriteModal').addEventListener('click', closeWriteModal);
document.getElementById('writeModal').addEventListener('click', e=>{ if(e.target===e.currentTarget) closeWriteModal(); });

function closeWriteModal(){
  document.getElementById('writeModal').classList.remove('open');
  resetForm();
}
function resetForm(){
  selectedFile = null;
  document.getElementById('fileInput').value = '';
  document.getElementById('titleInput').value = '';
  document.getElementById('artistInput').value = '';
  document.getElementById('tuningInput').value = '';
  document.getElementById('keyInput').value = '';
  document.getElementById('uploaderInput').value = '';
  document.getElementById('descInput').value = '';
  document.getElementById('fileInfo').innerHTML = '<i class="fas fa-paperclip"></i> íŒŒì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”';
  document.getElementById('fileInfo').classList.remove('has-file');
  document.getElementById('dropZone').classList.remove('drag-over');
  document.getElementById('submitBtn').disabled = true;
}

/* íŒŒì¼ ì„ íƒ */
function handleFile(file){
  if(!file) return;
  if(file.type !== 'application/pdf'){ showToast('PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.','error'); return; }
  if(file.size > 10*1024*1024){ showToast('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.','error'); return; }
  selectedFile = file;
  const info = document.getElementById('fileInfo');
  info.innerHTML = `<i class="fas fa-file-pdf"></i> ${esc(file.name)} (${(file.size/1024/1024).toFixed(2)} MB)`;
  info.classList.add('has-file');
  document.getElementById('submitBtn').disabled = false;
  showToast('íŒŒì¼ì´ ì„ íƒëìŠµë‹ˆë‹¤.','info');
}
document.getElementById('fileInput').addEventListener('change', e=>handleFile(e.target.files[0]));
const dz = document.getElementById('dropZone');
dz.addEventListener('dragover', e=>{ e.preventDefault(); dz.classList.add('drag-over'); });
dz.addEventListener('dragleave', ()=>dz.classList.remove('drag-over'));
dz.addEventListener('drop', e=>{ e.preventDefault(); dz.classList.remove('drag-over'); handleFile(e.dataTransfer.files[0]); });

/* ë“±ë¡ */
document.getElementById('submitBtn').addEventListener('click', async ()=>{
  const title  = document.getElementById('titleInput').value.trim();
  const artist = document.getElementById('artistInput').value.trim();
  if(!title)  { showToast('ê³¡ ì œëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.','error'); return; }
  if(!artist) { showToast('ì•„í‹°ìŠ¤íŠ¸ëª…ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.','error'); return; }
  if(!selectedFile){ showToast('PDF íŒŒì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.','error'); return; }

  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ë“±ë¡ ì¤‘â€¦';

  const reader = new FileReader();
  reader.onload = async e=>{
    try{
      await apiPost({
        title,
        artist,
        instrument: document.getElementById('instrumentSelect').value,
        genre:      document.getElementById('genreSelect').value,
        difficulty: document.getElementById('diffSelect').value,
        tuning:     document.getElementById('tuningInput').value.trim(),
        key:        document.getElementById('keyInput').value.trim(),
        uploader:   document.getElementById('uploaderInput').value.trim() || 'ìµëª…',
        desc:       document.getElementById('descInput').value.trim(),
        file_name:  selectedFile.name,
        file_data:  e.target.result,
        downloads:  0,
        likes:      0,
        views:      0,
      });
      closeWriteModal();
      showToast('ì•…ë³´ê°€ ë“±ë¡ëìŠµë‹ˆë‹¤! ğŸµ','success');
      currentPage = 1;
      loadScores();
    } catch(err){
      showToast('ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. íŒŒì¼ì´ ë„ˆë¬´ í¬ê±°ë‚˜ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.','error');
    } finally{
      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-upload"></i> ë“±ë¡í•˜ê¸°';
    }
  };
  reader.onerror = ()=>{
    showToast('íŒŒì¼ ì½ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.','error');
    btn.disabled = false;
    btn.innerHTML = '<i class="fas fa-upload"></i> ë“±ë¡í•˜ê¸°';
  };
  reader.readAsDataURL(selectedFile);
});

/* â”€â”€ PDF ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ ë‹«ê¸° â”€â”€ */
document.getElementById('closePdfModal').addEventListener('click', closePdfModal);
document.getElementById('pdfCloseBtn').addEventListener('click', closePdfModal);
document.getElementById('pdfOverlay').addEventListener('click', e=>{ if(e.target===e.currentTarget) closePdfModal(); });
function closePdfModal(){
  document.getElementById('pdfOverlay').classList.remove('open');
  document.getElementById('pdfViewer').src = '';
}

/* â”€â”€ ì´ˆê¸°í™” â”€â”€ */
bindSidebar();
loadScores();

/* â”€â”€ ê´‘ê³  ë§ˆìš´íŠ¸ â”€â”€ */
mountAds('scoreAdLeft',  ['SCORE_L1','SCORE_L2','SCORE_L3','SCORE_L4']);
mountAds('scoreAdRight', ['SCORE_R1','SCORE_R2','SCORE_R3','SCORE_R4'], true);
</script>
<script>
// í–„ë²„ê±° ë©”ë‰´
document.addEventListener('DOMContentLoaded', function() {
    const btn = document.getElementById('hamburgerBtn');
    const menu = document.getElementById('mobileMenu');
    if (btn && menu) {
        btn.addEventListener('click', function() {
            const isOpen = menu.classList.toggle('is-open');
            btn.classList.toggle('is-open', isOpen);
        });
        document.addEventListener('click', function(e) {
            if (!btn.contains(e.target) && !menu.contains(e.target)) {
                menu.classList.remove('is-open');
                btn.classList.remove('is-open');
            }
        });
    }
});
</script>
<!-- Auth -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script src="js/auth.js"></script>
<script src="js/auth-header.js"></script>
<script>
// ì•…ë³´ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ ë¡œê·¸ì¸ ê°€ë“œ
document.addEventListener('click', async function(e) {
  const target = e.target.closest('.upload-btn, .download-btn, .score-upload-btn, [data-guard], button[type="submit"]');
  if (!target) return;
  if (await requireLogin('score.html')) { e.preventDefault(); e.stopImmediatePropagation(); }
}, true);
</script>

</body>
</html>
